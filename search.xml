<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Swiftå‡½æ•°æ´¾å‘æœºåˆ¶]]></title>
    <url>%2F2019%2F0510%2Fswift-function-dispatch-mechanism.html</url>
    <content type="text"><![CDATA[ä¸€ä¸ªä»¤äººå›°æƒ‘çš„å°é—®é¢˜å¤§å®¶è¯·çœ‹ä¸‹é¢è¿™æ®µä»£ç (æ‘˜è‡ªobjc.io twitterçš„swift quiz) 12345678910111213141516protocol Drawing &#123; func render()&#125;extension Drawing &#123; func circle() &#123; p rint(&quot;protocol&quot;)&#125; func render() &#123; circle()&#125;&#125;class SVG: Drawing &#123; func circle()&#123; print(&quot;class&quot;) &#125;&#125;SVG().render()// what&apos;s the output? è¯·ç»™å‡ºä½ çš„ç­”æ¡ˆğŸ˜„ æ ¹æ®å½“æ—¶çš„ç»Ÿè®¡ï¼Œ43%é€‰æ‹©äº†protocol, 57%é€‰æ‹©äº†classã€‚ä½†çœŸç†å¾€å¾€æŒæ¡åœ¨å°‘æ•°äººæ‰‹ä¸­ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯protocolã€‚objcç»™å‡ºçš„è§£é‡Šæ˜¯: circleå‡½æ•°å£°æ˜åœ¨protocolçš„extensioné‡Œé¢ï¼Œæ‰€ä»¥ä¸æ˜¯åŠ¨æ€æ´¾å‘ï¼Œå¹¶ä¸”ç±»æ²¡æœ‰å®ç°renderå‡½æ•°ï¼Œæ‰€ä»¥è¾“å‡ºä¸ºprotocol. æ›´ä¸ºå‡†ç¡®çš„è¯´æ³•åº”è¯¥æ˜¯: extensionä¸­å£°æ˜çš„å‡½æ•°æ˜¯é™æ€æ´¾å‘ï¼Œç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†è°ƒç”¨åœ°å€ï¼Œç±»æ— æ³•é‡å†™å®ç°ã€‚ æ´¾å‘æœºåˆ¶åœ¨æ›´æ·±å…¥ç ”ç©¶Swiftå‡½æ•°æ´¾å‘æœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦äº†è§£ä¸‹å‡½æ•°æ´¾å‘çš„åŸºæœ¬çŸ¥è¯†ã€‚å‡½æ•°æ´¾å‘å°±æ˜¯CPUåœ¨å†…å­˜ä¸­æ‰¾åˆ°è¯¥å‡½æ•°åœ°å€å¹¶è°ƒç”¨çš„è¿‡ç¨‹ã€‚å‡½æ•°æ´¾å‘æœ‰ä¸‰ç§ç±»å‹: é™æ€æ´¾å‘ï¼Œå‡½æ•°è¡¨æ´¾å‘å’Œæ¶ˆæ¯æ´¾å‘ã€‚å½“æˆ‘ä»¬åœ¨é€‰æ‹©æ—¶ï¼Œéœ€è¦å¹³è¡¡ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡å’ŒåŠ¨æ€æ€§ï¼Œé€‰æ‹©æœ€é€‚åˆå½“ä¸‹æƒ…æ™¯çš„æ´¾å‘æ–¹å¼ã€‚ ç›´æ¥æ´¾å‘ç›´æ¥æ´¾å‘æ˜¯ä¸‰ç§æ´¾å‘æ–¹å¼ä¸­æœ€å¿«çš„ã€‚CPUç›´æ¥æŒ‰ç…§å‡½æ•°åœ°å€è°ƒç”¨ï¼Œä½¿ç”¨æœ€å°‘çš„æŒ‡ä»¤é›†ï¼ŒåŠæœ€å¿«çš„äº‹æƒ…ã€‚å½“ç¼–è¯‘å™¨å¯¹ç¨‹åºè¿›è¡Œä¼˜åŒ–çš„æ—¶å€™ï¼Œä¹Ÿå¸¸å¸¸å°†å‡½æ•°å†…è”ï¼Œä½¿ä¹‹æˆä¸ºç›´æ¥æ´¾å‘æ–¹å¼ï¼Œä¼˜åŒ–æ‰§è¡Œé€Ÿåº¦ã€‚æˆ‘ä»¬ç†ŸçŸ¥çš„C++é»˜è®¤ä½¿ç”¨ç›´æ¥æ´¾å‘æ–¹å¼ï¼Œåœ¨Swiftä¸­ç»™å‡½æ•°åŠ ä¸Šfinalå…³é”®å­—ï¼Œè¯¥å‡½æ•°ä¹Ÿä¼šå˜æˆç›´æ¥æ´¾å‘çš„æ–¹å¼ã€‚å½“ç„¶ï¼Œæœ‰åˆ©å°±æœ‰å¼Šï¼Œç›´æ¥æ´¾å‘æœ€å¤§çš„å¼Šç—…å°±æ˜¯æ²¡æœ‰åŠ¨æ€æ€§ï¼Œä¸æ”¯æŒç»§æ‰¿ã€‚ å‡½æ•°è¡¨æ´¾å‘è¿™ç§æ–¹å¼æ˜¯ç¼–è¯‘å‹è¯­è¨€æœ€å¸¸è§çš„æ´¾å‘æ–¹å¼ï¼Œä»–æ—¢ä¿è¯äº†åŠ¨æ€æ€§ä¹Ÿå…¼é¡¾äº†æ‰§è¡Œæ•ˆç‡ã€‚å‡½æ•°æ‰€åœ¨çš„ç±»ä¼šç»´æŠ¤ä¸€ä¸ªâ€å‡½æ•°è¡¨â€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„è™šå‡½æ•°è¡¨ã€‚è¯¥å‡½æ•°è¡¨å­˜å–äº†æ¯ä¸ªå‡½æ•°å®ç°çš„æŒ‡é’ˆã€‚æ¯ä¸ªç±»çš„vtableåœ¨ç¼–è¯‘æ—¶å°±ä¼šè¢«æ„å»ºï¼Œæ‰€ä»¥ä¸ç›´æ¥æ´¾å‘ç›¸æ¯”åªå¤šå‡ºäº†ä¸¤ä¸ªè¯»å–çš„å·¥ä½œ: è¯»å–è¯¥ç±»çš„vtableå’Œè¯¥å‡½æ•°çš„æŒ‡é’ˆã€‚ç†è®ºä¸Šè¯´ï¼Œå‡½æ•°è¡¨æ´¾å‘ä¹Ÿæ˜¯ä¸€ç§é«˜æ•ˆçš„æ–¹å¼ã€‚ä¸è¿‡å’Œç›´æ¥æ´¾å‘ç›¸æ¯”ï¼Œç¼–è¯‘å™¨å¯¹æŸäº›å«æœ‰å‰¯ä½œç”¨çš„å‡½æ•°å´æ— æ³•ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯å¯¼è‡´å‡½æ•°è¡¨æ´¾å‘å˜æ…¢çš„åŸå› ä¹‹ä¸€ã€‚è€Œä¸”Swiftç±»æ‰©å±•é‡Œé¢çš„æ–¹æ³•æ— æ³•åŠ¨æ€åŠ å…¥è¯¥ç±»çš„å‡½æ•°è¡¨ä¸­ï¼Œåªèƒ½ä½¿ç”¨é™æ€æ´¾å‘çš„æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯å‡½æ•°è¡¨æ´¾å‘çš„ç¼ºé™·ä¹‹ä¸€ã€‚ æˆ‘ä»¬æ¥çœ‹å¦‚ä¸‹ä»£ç : 123456789class Vehiche &#123; func run() &#123;&#125; func brake() &#123;&#125;&#125;class Car: Vehiche &#123; override func brake() &#123;&#125; func speedUp() &#123;&#125;&#125; å½“å‰æƒ…æ™¯ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸¤ä¸ªå‡½æ•°è¡¨: ä¸€ä¸ªå±äºVehicheç±»ï¼Œå¦ä¸€ä¸ªå±äºCarç±»ï¼Œå†…å­˜å¸ƒå±€å¦‚ä¸‹: 12let car = Car()car.brake() å½“è°ƒç”¨å‡½æ•°brakeæ—¶ï¼Œè¿‡ç¨‹å¦‚ä¸‹: è¯»å–è¯¥å¯¹è±¡(0XB00)çš„vtable. è¯»å–brakeå‡½æ•°æŒ‡é’ˆ0x222. è·³è½¬åˆ°åœ°å€0X222ï¼Œè¯»å–å‡½æ•°å®ç°. æ¶ˆæ¯æ´¾å‘è¿™ç§æ´¾å‘æ–¹å¼æ˜¯ä¸‰ç§é‡Œé¢æœ€åŠ¨æ€çš„ä¸€ç§æ–¹å¼ã€‚ç”±äºSwfitä½¿ç”¨çš„ä¾æ—§æ˜¯Objcçš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œçš„æ¶ˆæ¯æ´¾å‘å…¶å®ä¹Ÿå°±æ˜¯Objcçš„Message Passing(æ¶ˆæ¯ä¼ é€’)ã€‚ 1id returnValue = [someObject messageName:parameter]; someObjectå°±æ˜¯æ¥æ”¶è€…ï¼ŒmessageNameå°±æ˜¯é€‰æ‹©å™¨ï¼Œé€‰æ‹©å™¨å’Œå‚æ•°ä¸€èµ·è¢«ç§°ä¸º â€œæ¶ˆæ¯â€œã€‚å½“ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†è¯¥æ¶ˆæ¯è½¬æ¢æˆä¸€æ¡æ ‡å‡†çš„Cè¯­è¨€è°ƒç”¨ï¼š 1id returnValue = objc_msgSend(someObject, @selector(messageName:), parameter); objc_msgSendå‡½æ•°å›ä¸€å¥æ¥æ”¶è€…å’Œé€‰æ‹©å™¨çš„ç±»å‹æ¥è°ƒç”¨é€‚å½“çš„æ–¹æ³•ï¼Œå®ƒä¼šå»æ¥æ”¶è€…æ‰€å±ç±»ä¸­æœç´¢å…¶æ–¹æ³•åˆ—è¡¨ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ï¼Œåˆ™è·³è½¬åˆ°å¯¹åº”å®ç°ï¼›è‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™æ²¿ç€ç»§æ‰¿ä½“ç³»ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œè‹¥èƒ½æ‰¾åˆ°ï¼Œåˆ™è·³è½¬ï¼›å¦‚æœæœ€ç»ˆè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œé‚£å°±æ‰§è¡Œè¾¹ç•Œæƒ…å†µçš„æ“ä½œï¼Œä¾‹å¦‚ Message forwarding(æ¶ˆæ¯è½¬å‘)ã€‚ è¿™æ ·åšçš„å¥½å¤„åœ¨å“ªé‡Œå‘¢ï¼Ÿè¿™ç§è¿ä½œæ–¹å¼çš„å…³é”®åœ¨äºå¼€å‘è€…å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜å‡½æ•°çš„è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Swizzlingã€‚Swizzlingç»å¸¸ç”¨æ¥é…ç½®æœåŠ¡ä»¥åŠhackæŸäº›æµ‹è¯•caseã€‚ KVOå°±æ˜¯ä½¿ç”¨swizzlingå®ç°çš„ã€‚ è¿™ç§æ´¾å‘æ–¹å¼çš„æµç¨‹æ­¥éª¤ä¼¼ä¹å¾ˆå¤šï¼Œæ‰€å¹¸çš„æ˜¯objc_msgSendä¼šå°†åŒ¹é…çš„ç»“æœç¼“å­˜åˆ°fast map(å¿«é€Ÿæ˜ å°„è¡¨)ä¸­ï¼Œè€Œä¸”æ¯ä¸ªç±»éƒ½æœ‰è¿™æ ·ä¸€å—ç¼“å­˜ï¼›è‹¥æ˜¯ä¹‹åå‘é€ç›¸åŒçš„æ¶ˆæ¯ï¼Œæ‰§è¡Œé€Ÿç‡ä¼šå¾ˆå¿«ã€‚ Swiftå¦‚ä½•æ´¾å‘å‡½æ•°äº†è§£äº†å‡½æ•°æ´¾å‘çš„åŸºæœ¬çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹Swiftå¦‚ä½•å¤„ç†å‡½æ•°æ´¾å‘ä»¥åŠå¦‚ä½•è¯æ˜è¯¥ç§æ´¾å‘ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ æ€»ç»“è¡¨: ä»ä¸Šè¡¨ä¸­æˆ‘ä»¬å¯ä»¥ç›´è§‚çš„æ€»ç»“å‡ºï¼šå‡½æ•°çš„æ´¾å‘æ–¹å¼å’Œä»¥ä¸‹ä¸¤ç‚¹ç›¸å…³è”: å¯¹è±¡ç±»å‹; å€¼ç±»å‹æ€»æ˜¯ä½¿ç”¨ç›´æ¥æ´¾å‘(é™æ€æ´¾å‘ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰ç»§æ‰¿ä½“ç³») å‡½æ•°å£°æ˜çš„ä½ç½®; ç›´æ¥åœ¨å®šä¹‰ä¸­å£°æ˜å’Œåœ¨æ‰©å±•ä¸­(extension)å£°æ˜ é™¤æ­¤ä¹‹å¤–ï¼Œæ˜¾å¼çš„æŒ‡å®šæ´¾å‘æ–¹å¼ä¹Ÿä¼šæ”¹å˜å‡½æ•°å…¶åŸæœ‰çš„æ´¾å‘æ–¹å¼ï¼Œä¾‹å¦‚æ·»åŠ finalæˆ–è€…@objcå…³é”®å­—ç­‰ç­‰ï¼›ä»¥åŠç¼–è¯‘å™¨å¯¹ç‰¹å®šå‡½æ•°çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚å°†ä»æœªè¢«é‡å†™çš„ç§æœ‰å‡½æ•°ä¼˜åŒ–æˆé™æ€æ´¾å‘ã€‚ ä¸‹é¢æˆ‘ä»¬å°±è¿™å››ä¸ªæ–¹é¢æ¥åˆ†æå’Œæ¢è®¨Swiftçš„æ´¾å‘æ–¹å¼ï¼Œä»¥åŠè¯æ˜å…¶æ´¾å‘æ–¹å¼ã€‚ å¯¹è±¡ç±»å‹å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå€¼ç±»å‹ï¼Œä¹Ÿå°±æ˜¯structçš„å¯¹è±¡æ€»æ˜¯ä½¿ç”¨é™æ€æ´¾å‘; classå¯¹è±¡ä½¿ç”¨å‡½æ•°è¡¨æ´¾å‘(éextension)ã€‚è¯·çœ‹å¦‚ä¸‹ç¤ºä¾‹: 1234567class MyClass &#123; func testOfClass() &#123;&#125;&#125;struct myStruct &#123; func testOfStruct() &#123;&#125;&#125; ç°åœ¨æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†swiftä»£ç è½¬æ¢ä¸ºSIL(ä¸­é—´ç )ä»¥ä¾¿æŸ¥çœ‹å…¶å‡½æ•°æ´¾å‘æ–¹å¼: 1swiftc -emit-silgen -O test.swift è¾“å‡ºç»“æœå¦‚ä¸‹:ã€ 123456...sil_vtable MyClass &#123; #MyClass.testOfClass!1: (MyClass) -&gt; () -&gt; () : @$s4test7MyClassC0a2OfC0yyF // MyClass.testOfClass() #MyClass.init!allocator.1: (MyClass.Type) -&gt; () -&gt; MyClass : @$s4test7MyClassCACycfC // MyClass.__allocating_init() #MyClass.deinit!deallocator.1: @$s4test7MyClassCfD // MyClass.__deallocating_deinit&#125; é¦–å…ˆswiftä¼šä¸ºclassæ·»åŠ initå’Œ@objc deinitæ–¹æ³•ï¼Œä¸ºstructæ·»åŠ initæ–¹æ³•ã€‚åœ¨æ–‡ä»¶çš„ç»“å°¾å¤„å°±ä¼šæ˜¾ç¤ºå¦‚ä¸Šä»£ç ï¼Œå®ƒå±•ç¤ºäº†å“ªäº›å‡½æ•°æ˜¯å‡½æ•°è¡¨æ´¾å‘çš„ï¼Œä»¥åŠå®ƒä»¬çš„æ ‡è¯†ç¬¦ã€‚ç”±äºstructç±»å‹ä»…ä½¿ç”¨é™æ€æ´¾å‘ï¼Œæ‰€ä»¥ä¸ä¼šæ˜¾ç¤ºsil_vtableå­—æ ·ã€‚ å‡½æ•°å£°æ˜ä½ç½®å‡½æ•°å£°æ˜ä½ç½®çš„ä¸åŒä¹Ÿä¼šå¯¼è‡´æ´¾å‘æ–¹å¼çš„ä¸åŒã€‚åœ¨Swiftä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸åœ¨extensioné‡Œé¢æ·»åŠ æ‰©å±•æ–¹æ³•ã€‚æ ¹æ®æˆ‘ä»¬ä¹‹å‰æ€»ç»“çš„è¡¨æ ¼ï¼Œé€šå¸¸extensionä¸­å£°æ˜çš„å‡½æ•°éƒ½é»˜è®¤ä½¿ç”¨é™æ€æ´¾å‘ã€‚ 12345678910111213141516protocol MyProtocol &#123; func testOfProtocol()&#125;extension MyProtocol &#123; func testOfProtocolInExtension() &#123;&#125;&#125;class MyClass: MyProtocol &#123; func testOfClass() &#123;&#125; func testOfProtocol() &#123;&#125;&#125;extension MyClass &#123; func testOfClassInExtension() &#123;&#125;&#125; æˆ‘ä»¬åˆ†åˆ«åœ¨protocolå’Œclassä¸­å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œå†åœ¨å…¶extensionä¸­å£°æ˜ä¸€ä¸ªå‡½æ•°; æœ€åè®©ç±»å®ç°åè®®çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè½¬æ¢æˆSILä»£ç åå¦‚ä¸‹: 1234567891011...sil_vtable MyClass &#123; #MyClass.testOfClass!1: (MyClass) -&gt; () -&gt; () : @$s4test7MyClassC0a2OfC0yyF // MyClass.testOfClass() #MyClass.testOfProtocol!1: (MyClass) -&gt; () -&gt; () : @$s4test7MyClassC0A10OfProtocolyyF // MyClass.testOfProtocol() #MyClass.init!allocator.1: (MyClass.Type) -&gt; () -&gt; MyClass : @$s4test7MyClassCACycfC // MyClass.__allocating_init() #MyClass.deinit!deallocator.1: @$s4test7MyClassCfD // MyClass.__deallocating_deinit&#125;sil_witness_table hidden MyClass: MyProtocol module test &#123; method #MyProtocol.testOfProtocol!1: &lt;Self where Self : MyProtocol&gt; (Self) -&gt; () -&gt; () : @$s4test7MyClassCAA0B8ProtocolA2aDP0a2OfD0yyFTW // protocol witness for MyProtocol.testOfProtocol() in conformance MyClass&#125; æˆ‘ä»¬å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ï¼Œå£°æ˜åœ¨åè®®æˆ–è€…ç±»ä¸»ä½“ä¸­çš„å‡½æ•°æ˜¯ä½¿ç”¨å‡½æ•°è¡¨æ´¾å‘çš„; è€Œå£°æ˜åœ¨æ‰©å±•ä¸­çš„å‡½æ•°åˆ™æ˜¯é™æ€æ´¾å‘ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯: å½“æˆ‘ä»¬åœ¨protocolä¸­å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”åœ¨protocolçš„extensionä¸­å®ç°äº†å®ƒï¼Œè€Œä¸”æ²¡æœ‰å…¶ä»–ç±»å‹é‡å†™è¯¥å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°å°±æ˜¯ç›´æ¥æ´¾å‘ï¼Œç®—æ˜¯é€šç”¨å‡½æ•°ã€‚ æŒ‡å®šæ´¾å‘æ–¹å¼ç»™å‡½æ•°æ·»åŠ å…³é”®å­—çš„ä¿®é¥°ä¹Ÿèƒ½æ”¹å˜å…¶æ´¾å‘æ–¹å¼ã€‚ finalæ·»åŠ äº†finalå…³é”®å­—çš„å‡½æ•°æ— æ³•è¢«é‡å†™ï¼Œä½¿ç”¨ç›´æ¥æ´¾å‘ï¼Œä¸ä¼šåœ¨vtableä¸­å‡ºç°ã€‚å¹¶ä¸”å¯¹Objc runtimeä¸å¯è§ã€‚ dynamicå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å‡½æ•°å‡å¯æ·»åŠ dynamicå…³é”®å­—ã€‚åœ¨Swift5ä¸­ï¼Œç»™å‡½æ•°æ·»åŠ dynamicçš„ä½œç”¨æ˜¯ä¸ºäº†èµ‹äºˆéobjcç±»å’Œå€¼ç±»å‹(structå’Œenum)åŠ¨æ€æ€§ã€‚æˆ‘ä»¬æ¥çœ‹å¦‚ä¸‹ä»£ç : 123struct Test &#123; dynamic func test() &#123;&#125;&#125; æˆ‘ä»¬èµ‹äºˆäº†testå‡½æ•°åŠ¨æ€æ€§ã€‚å°†å…¶è½¬æ¢æˆSILä¸­é—´ç åå¦‚ä¸‹: 12345678// Test.test()sil hidden [dynamically_replacable] @$s4test4TestVAAyyF : $@convention(method) (Test) -&gt; () &#123;// %0 // user: %1bb0(%0 : @trivial $Test): debug_value %0 : $Test, let, name &quot;self&quot;, argno 1 // id: %1 %2 = tuple () // user: %3 return %2 : $() // id: %3&#125; // end sil function &apos;$s4test4TestVAAyyF&apos; æˆ‘ä»¬åœ¨ç¬¬äºŒè¡Œå¯ä»¥çœ‹åˆ°testå‡½æ•°å¤šäº†ä¸€ä¸ªâ€œå±æ€§â€: dynamically_replacable, ä¹Ÿå°±æ˜¯è¯´æ·»åŠ dynamicå…³é”®å­—å°±æ˜¯èµ‹äºˆå‡½æ•°åŠ¨æ€æ›¿æ¢çš„èƒ½åŠ›ã€‚é‚£ä»€ä¹ˆæ˜¯åŠ¨æ€æ›¿æ¢å‘¢? ç®€è€Œè¨€ä¹‹å°±æ˜¯æä¾›ä¸€ç§é€”å¾„ï¼Œæ¯”æ–¹è¯´ï¼Œå¯ä»¥å°†Module Aä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œåœ¨Module Bä¸­åŠ¨æ€æ›¿æ¢ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1234// Module Astruct Foo &#123; dynamic func bar() &#123;&#125;&#125; 12345678// Module Bextension Foo &#123; @_dynamicReplacement(for: bar()0 func barReplacement() &#123; ... // Calls previously active implementation of bar() bar() &#125; æ·»åŠ dynamicå…³é”®å­—å¹¶ä¸ä»£è¡¨å¯¹Objcå¯è§ã€‚ @objcè¯¥å…³é”®å­—å¯ä»¥å°†Swiftå‡½æ•°æš´éœ²ç»™Objcè¿è¡Œæ—¶ï¼Œä½†å¹¶ä¸ä¼šæ”¹å˜å…¶æ´¾å‘æ–¹å¼ï¼Œä¾æ—§æ˜¯å‡½æ•°è¡¨æ´¾å‘ã€‚ä¸¾ä¾‹å¦‚ä¸‹: 123class Test &#123; @objc func test() &#123;&#125;&#125; SILä»£ç å¦‚ä¸‹: 1234567891011121314151617181920212223...// @objc Test.test()sil hidden [thunk] @$s4test4TestCAAyyFTo : $@convention(objc_method) (Test) -&gt; () &#123;// %0 // user: %1bb0(%0 : @unowned $Test): %1 = copy_value %0 : $Test // users: %6, %2 %2 = begin_borrow %1 : $Test // users: %5, %4 // function_ref Test.test() %3 = function_ref @$s4test4TestCAAyyF : $@convention(method) (@guaranteed Test) -&gt; () // user: %4 %4 = apply %3(%2) : $@convention(method) (@guaranteed Test) -&gt; () // user: %7 end_borrow %2 : $Test // id: %5 destroy_value %1 : $Test // id: %6 return %4 : $() // id: %7&#125; // end sil function &apos;$s4test4TestCAAyyFTo&apos;...sil_vtable Test &#123; #Test.test!1: (Test) -&gt; () -&gt; () : @$s4test4TestCAAyyF // Test.test() #Test.init!allocator.1: (Test.Type) -&gt; () -&gt; Test : @$s4test4TestCACycfC // Test.__allocating_init() #Test.deinit!deallocator.1: @$s4test4TestCfD // Test.__deallocating_deinit&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°testæ–¹æ³•ä¾æ—§åœ¨â€œè™šå‡½æ•°åˆ—è¡¨â€ä¸­ï¼Œè¯æ˜å…¶å®å‡½æ•°è¡¨æ´¾å‘ã€‚å¦‚æœå¸Œæœ›testå‡½æ•°ä½¿ç”¨æ¶ˆæ¯æ´¾å‘ï¼Œåˆ™éœ€è¦é¢å¤–æ·»åŠ dynamicå…³é”®å­—ã€‚ @inline or static@inlineå…³é”®å­—é¡¾åæ€ä¹‰æ˜¯æƒ³å‘Šè¯‰ç¼–è¯‘å™¨å°†æ­¤å‡½æ•°ç›´æ¥æ´¾å‘ï¼Œä½†å°†å…¶è½¬æ¢æˆSILä»£ç åï¼Œä¾æ—§æ˜¯vtableæ´¾å‘ã€‚Staticå…³é”®å­—ä¼šå°†å‡½æ•°å˜ä¸ºç›´æ¥æ´¾å‘ã€‚ ç¼–è¯‘å™¨ä¼˜åŒ–Swiftä¼šå°½å¯èƒ½çš„å»ä¼˜åŒ–å‡½æ•°æ´¾å‘æ–¹å¼ã€‚æˆ‘ä»¬ä¸Šæ–‡æåˆ°ï¼Œå½“ä¸€ä¸ªç±»å£°æ˜äº†ä¸€ä¸ªç§æœ‰å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°å¾ˆå¯èƒ½ä¼šè¢«ä¼˜åŒ–ä¸ºç›´æ¥æ´¾å‘ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬åœ¨Swiftä¸­ä½¿ç”¨target-actionæ¨¡å¼æ—¶ï¼Œç§æœ‰selectorä¼šæŠ¥é”™çš„åŸå› (Objective-C æ— æ³•è·å– #selector æŒ‡å®šçš„å‡½æ•°)ã€‚ æ´¾å‘æ€»ç»“æœ€åæˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ€»ç»“ä¸‹Swiftä¸­çš„æ´¾å‘æ–¹å¼: ä»ä¸Šè¡¨å¯è§ï¼Œæˆ‘ä»¬åœ¨ç±»å‹çš„ä¸»ä½“ä¸­å£°æ˜çš„å‡½æ•°å¤§éƒ½æ˜¯å‡½æ•°è¡¨æ´¾å‘ï¼Œè¿™ä¹Ÿæ˜¯Swiftä¸­æœ€ä¸ºå¸¸è§çš„æ´¾å‘æ–¹å¼ï¼›è€Œæ‰©å±•å¤§éƒ½æ˜¯ç›´æ¥æ´¾å‘ï¼›åªæœ‰å†æ·»åŠ äº†ç‰¹å®šå…³é”®å­—åï¼Œå¦‚@objc, final, dynamicåï¼Œå‡½æ•°æ´¾å‘æ–¹å¼æ‰ä¼šæœ‰æ‰€æ”¹å˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç¼–è¯‘å™¨å¯èƒ½å°†æŸäº›æ–¹æ³•ä¼˜åŒ–ä¸ºç›´æ¥æ´¾å‘ã€‚ä¾‹å¦‚ç§æœ‰å‡½æ•°ã€‚ å¦‚ä½•é€‰æ‹©æ´¾å‘æ–¹å¼è®²äº†è¿™ä¹ˆå¤šå‡½æ•°æ´¾å‘çš„æ–¹å¼ï¼Œé‚£å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ–è€…è¯´å¦‚ä½•é€‰æ‹©æ´¾å‘æ–¹å¼å‘¢ï¼Ÿ æˆ‘æ€»ç»“äº†ä¸¤ç‚¹: å¸®åŠ©æˆ‘ä»¬ç†è§£ä¸€äº›â€œå¥‡æ€ªçš„â€è¡Œä¸ºï¼Œä¾‹å¦‚ä¸ºä½•extensionä¸­çš„å‡½æ•°æ— æ³•è¢«å­ç±»ç»§æ‰¿ï¼Œä¸ºä½•éœ€è¦æ·»åŠ @objcç”šè‡³æ˜¯dynamicåæ‰èƒ½è¢«é‡å†™ã€‚ æä¾›é€‰æ‹©ç±»å‹çš„æ¡ä»¶ï¼Œä¾‹å¦‚æ‚¨çš„appå¯¹æ€§èƒ½è¦æ±‚å¾ˆè‹›åˆ»ï¼Œé‚£å°½é‡ä½¿ç”¨å€¼ç±»å‹ï¼›å¹¶ä¸”å¯¹å¼•ç”¨ç±»å‹æ–¹æ³•æ·»åŠ å…³é”®å­—æè¿°ã€‚ æ€»çš„æ¥è¯´ï¼Œå¦‚ä½•é€‰æ‹©è¿˜æ˜¯å–å†³äºä¸šåŠ¡ç±»å‹ã€‚é¦–å…ˆè¦ç¡®å®šä½¿ç”¨å¼•ç”¨ç±»å‹è¿˜æ˜¯å€¼ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿéƒ¨åˆ†å†³å®šäº†å‡½æ•°çš„æ´¾å‘æ–¹å¼ï¼›ä¹‹åç¡®å®šæ˜¯å¦ç»™å‡½æ•°æ·»åŠ å…³é”®å­—ï¼Œä¾‹å¦‚@objcï¼Œfinalæˆ–dynamicï¼Œä»¥è¾¾åˆ°å‡†ç¡®æè¿°è¯¥å‡½æ•°çš„ç›®çš„ã€‚]]></content>
      <categories>
        <category>åº•å±‚åŸç†</category>
        <category>å¼€å‘åŸºç¡€</category>
      </categories>
      <tags>
        <tag>å‡½æ•°</tag>
        <tag>åº•å±‚åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOS Appå¯åŠ¨çš„å¥¥ç§˜]]></title>
    <url>%2F2019%2F0420%2Fthe-mystery-of-ios-app-launch.html</url>
    <content type="text"><![CDATA[éšç€æ™ºèƒ½æ‰‹æœºï¼Œå¹³æ¿åœ¨ä¸­å›½æ™®åŠç‡çš„ä¸Šå‡ï¼Œäººä»¬è¶Šæ¥è¶Šä¾èµ–ç§»åŠ¨è®¾å¤‡è¿›è¡Œå¨±ä¹ã€æ¶ˆè´¹ï¼Œç”±æ­¤å‚¬ç”Ÿå‡ºçš„Appæ›´æ˜¯å±‚å‡ºä¸ç©·ã€‚æ ¹æ®è‹¹æœ2019å¹´2æœˆçš„æ•°æ®ï¼Œç›®å‰AppStoreä¸Šçš„Appæ•°é‡å·²ç»è¶…è¿‡220ä¸‡ï¼Œæ¯”2018å¹´åŒæœŸå¢é•¿äº†è¿‘10ä¸‡ä¸ªAppã€‚2015å¹´6æœˆåˆ°2016å¹´6æœˆå¯è°“æ˜¯Appå‘å±•çš„é«˜é€Ÿæ—¶æœŸï¼Œä»…ä»…ä¸€å¹´æ—¶é—´å°±å¢é•¿äº†50ä¸‡ä¸ªAppï¼›åŒæ—¶æœŸä¹Ÿæ˜¯ä¸­å›½äº’è”ç½‘+çš„é»„é‡‘æ—¶æœŸï¼Œå„ç§åˆ›ä¸šé¡¹ç›®ï¼Œå¹³å°æ¨å‡ºäº†å„å¼å„æ ·çš„ç§»åŠ¨Appäº§å“ã€‚ é‚£ä¹ˆï¼Œéšç€Appçš„çˆ†å‘å¼å¢é•¿ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šæ¸…æ™°åœ°å‘ç°ï¼šå¤§å¤šæ•°Appæ˜¯æ— æ³•é•¿æœŸåœç•™åœ¨ç”¨æˆ·æ‰‹æœºé‡Œçš„ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªå¼€å‘è€…çš„è§’åº¦æ¥æ€è€ƒï¼šå¦‚ä½•æå‡ç”¨æˆ·ä½“éªŒï¼Œè®©æˆ‘ä»¬çš„Appåœ¨åŒç±»äº§å“ä¸­è„±é¢–è€Œå‡ºï¼Œæœ€ç»ˆèƒ½å¤Ÿé•¿æœŸç¨³å®šçš„å­˜åœ¨äºç”¨æˆ·æ‰‹æœºä¹‹ä¸­ã€‚ æ¯å½“æˆ‘ä»¬è¯´åˆ°ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å¾€å¾€æƒ³åˆ°çš„æ˜¯ä¼˜åŒ–ç•Œé¢ï¼Œäº¤äº’æ–¹å¼ç­‰ã€‚è¿™äº›å›ºç„¶é‡è¦ï¼Œä½†è¿™æ›´å¤šçš„æ˜¯äº§å“å’ŒUXçš„èŒè´£ã€‚ä½œä¸ºå¼€å‘ï¼Œæˆ‘ä»¬æ›´éœ€è¦è€ƒè™‘ä»–ä»¬æ— æ³•å®Œæˆçš„äº‹æƒ…ï¼Œæ›´åŠ é«˜ç«¯çš„äº‹æƒ…ï¼Œæ¯”æ–¹è¯´ï¼šä¼˜åŒ–Appçš„å¯åŠ¨æµç¨‹ã€‚ ä¸ºä»€ä¹ˆè¦è€ƒè™‘Appçš„å¯åŠ¨æ—¶é—´è¿™ä¸ªé—®é¢˜ä¹çœ‹ä¸Šå»æœ‰ç‚¹åºŸè¯è¿ç¯‡çš„æ„æ€ï¼Œå“ªä¸ªç”¨æˆ·ä¸å¸Œæœ›Appèƒ½å¤Ÿé£é€Ÿçš„æ‰“å¼€? å“ªä¸ªå…¬å¸ä¸å¸Œæœ›è‡ªå·±çš„Appèƒ½æœ‰è¿™æ ·å¥½çš„æ€§èƒ½ï¼Ÿä½†è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®è´¨æ˜¯å¸Œæœ›å¸®åŠ©å¼€å‘äººå‘˜ç†é¡ºä¸šåŠ¡ã€æœåŠ¡çš„åˆå§‹åŒ–æ€è·¯ï¼Œä»¥åŠæ„å»ºé¡¹ç›®çš„æ–¹å¼ã€‚ åœ¨å±•å¼€æ¥è¯´ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸‹ä»€ä¹ˆæ˜¯Appçš„å¯åŠ¨ï¼š é€šä¿—æ¥è®²ï¼Œå°±æ˜¯ä»ç”¨æˆ·ç‚¹å‡»Appå›¾æ ‡å¼€å§‹ï¼Œåˆ°çœ‹åˆ°ç¬¬ä¸€ä¸ªé¡µé¢çš„æ—¶é—´é—´éš”ã€‚ç»†åˆ†æ¥çœ‹ï¼ŒAppçš„å¯åŠ¨åˆ†ä¸¤ç§ï¼šå†·å¯åŠ¨å’Œçƒ­å¯åŠ¨ã€‚å†·å¯åŠ¨ï¼šAppå¯åŠ¨å‰ï¼Œå†…æ ¸æ²¡æœ‰ä¸ºå®ƒåˆ†é…ç›¸åº”çš„è¿›ç¨‹ã€‚çƒ­å¯åŠ¨ï¼šAppå†·å¯åŠ¨åï¼Œç”¨æˆ·å°†Appé€€å‡ºè‡³åå°ï¼Œå†è¿›å…¥çš„è¿‡ç¨‹ã€‚ çƒ­å¯åŠ¨æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œèƒ½åšçš„é€šç”¨çš„äº‹æƒ…éå¸¸å°‘ã€‚Appä»åå°å›æ¥ç›´æ¥è¿›å…¥AppDelegateç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå‰©ä¸‹çš„å°±æ˜¯Appè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœè¦ä¼˜åŒ–ï¼Œä¹Ÿä»…æ˜¯ä¸šåŠ¡ä¸Šçš„ä¼˜åŒ–ï¼Œæ¢å¤æ•°æ®ï¼Œåšä¸€äº›åŒæ­¥ã€‚æ‰€ä»¥æœ¬ç¯‡æˆ‘ä»¬åªå±•å¼€è®²å†·å¯åŠ¨(åæ–‡å°†ç”¨å¯åŠ¨ä»£æ›¿å†·å¯åŠ¨)çš„æµç¨‹å’Œä¼˜åŒ–ã€‚BTW: ç¬”è€…å»ºè®®å…ˆä»çƒ­å¯åŠ¨å¼€å§‹ä¼˜åŒ–ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†çš„æ€§èƒ½ç“¶é¢ˆéƒ½åœ¨è‡ªå®¶ä»£ç é‡Œã€‚ Appå¯åŠ¨æ­¥éª¤æ¦‚è§ˆä»å¤§æ–¹å‘è®²ï¼ŒAppå¯åŠ¨æ­¥éª¤åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š ä»ç³»ç»Ÿexec()è°ƒç”¨åˆ°æˆ‘ä»¬Appçš„main()ä¸ºæ­¢ (mainå‡½æ•°ä¹‹å‰) main()æ‰§è¡Œä¹‹å é¦–å±æ¸²æŸ“ç»“æŸ(è‡³ç¬¬ä¸€ä¸ªç•Œé¢çš„viewDidAppear:ï¼Œnib loading) æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š æ¦‚æ‹¬æ¥è®²ï¼šå†…æ ¸å…ˆå°†æˆ‘ä»¬çš„AppåŠ è½½è¿›å†…å­˜ï¼Œä¹‹ååŠ è½½ä¸€ä¸ªâ€œä¸­é—´ä»¶â€: dynamic loader(ç®€ç§°:dyld)ã€‚ä¹‹ådyldä¼šè´Ÿè´£åˆ†æAppçš„Mach-Oæ–‡ä»¶ä»¥åŠ è½½æ‰€éœ€çš„dynamic librariesã€‚ä¹‹ååˆ©ç”¨Rebasingå’ŒBindingä¿®æ­£å†…éƒ¨å’Œå¤–éƒ¨æŒ‡é’ˆæŒ‡å‘ã€‚æœ€ååŠ è½½runtimeç»„ä»¶ï¼Œruntimeç»„ä»¶åŠ è½½å¥½åå°±ä¼šå‘éœ€è¦åˆå§‹åŒ–çš„objectå‘é€æ¶ˆæ¯ï¼Œå¼€å§‹åˆå§‹åŒ–ã€‚ è‡³æ­¤ï¼Œmainå‡½æ•°ä¹‹å‰çš„æ­¥éª¤ç»“æŸã€‚ä¹‹åçš„æµç¨‹å°±æ˜¯æˆ‘ä»¬è€³ç†Ÿèƒ½è¯¦çš„ç”Ÿå‘½å‘¨æœŸäº†ï¼ŒAppå¼€å§‹åœ¨AppDelegateé‡Œé¢åˆå§‹åŒ–æˆ‘ä»¬è‡ªå®šä¹‰çš„æœåŠ¡ä»¥åŠæ¸²æŸ“é¦–å±ç­‰ã€‚ Crash Course (åè¯é€Ÿæˆç­)ç›¸ä¿¡ä½ çœ‹åˆ°è¿™é‡Œæˆ–å¤šæˆ–å°‘å·²ç»å¯¹å…¶ä¸­çš„ä¸€äº›åè¯æ„Ÿåˆ°é™Œç”Ÿç”šè‡³â€è®¨åŒâ€äº†ã€‚è¿™é‡Œé¢å¯èƒ½é™¤äº†runtimeï¼Œå…¶ä»–çš„ä½ éƒ½æ²¡æ¥è§¦è¿‡ã€‚æ‰€ä»¥ï¼Œè¿™ä¸€å°èŠ‚æˆ‘ä»¬é’ˆå¯¹ä¸Šè¿°æµç¨‹æ¶‰åŠåˆ°çš„åè¯åŠ ä»¥è§£é‡Šï¼Œå¹¶å¸®åŠ©å¤§å®¶æ‰©å……ä¸‹åº•å±‚çŸ¥è¯†ï¼Œæ›´å¥½çš„ç†è§£mainå‡½æ•°ä¹‹å‰å‘ç”Ÿçš„äº‹æƒ…ã€‚ å†…æ ¸å†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒã€‚iOSå’ŒOS Xä½¿ç”¨çš„éƒ½æ˜¯XNUå†…æ ¸ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“XNUå†…æ ¸çš„è¯¦ç»†æ¶æ„ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„åŠŸèƒ½å³å¯ï¼Œä¾‹å¦‚ï¼šæä¾›åŸºç¡€æœåŠ¡ï¼Œåƒçº¿ç¨‹ï¼Œè¿›ç¨‹ç®¡ç†ï¼ŒIPC(è¿›ç¨‹é—´é€šä¿¡)ï¼Œæ–‡ä»¶ç³»ç»Ÿç­‰ç­‰ã€‚ ä¸Šå›¾é˜è¿°äº†å†…æ ¸æ˜¯å¦‚ä½•åŠ è½½æˆ‘ä»¬çš„Appåˆ°è¿›ç¨‹ä¸­çš„ã€‚åœ¨è¿™å¹…å›¾é‡Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š PAGEZEROæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„Appèµ·å§‹ä½ç½®æ˜¯ä¸ç¡®å®šçš„ï¼Ÿ è¿™å°±è¦æ¶‰åŠåˆ°ä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šASLRã€‚ ASLR(åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–) + Code Signç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“åº”ç”¨æ˜ å°„åˆ°é€»è¾‘åœ°å€ç©ºé—´çš„æ—¶å€™ï¼Œåˆ©ç”¨ASLRæŠ€æœ¯ï¼Œå¯ä»¥ä½¿å¾—åº”ç”¨çš„èµ·å§‹åœ°å€æ€»æ˜¯éšæœºçš„ï¼Œä»¥é¿å…é»‘å®¢é€šè¿‡èµ·å§‹åœ°å€+åç§»é‡æ‰¾åˆ°å‡½æ•°çš„åœ°å€ã€‚ASLRå’ŒCode Signæ˜¯iOSä¸¤ç§ä¸»è¦çš„å®‰å…¨æŠ€æœ¯ã€‚ç›¸ä¿¡å¤§å®¶å¯¹Code Signå¹¶ä¸é™Œç”Ÿï¼Œåœ¨åº•å±‚ä¸Šè¿›è¡Œcode signçš„æ—¶å€™ï¼ŒåŠ å¯†å“ˆå¸Œæ˜¯é’ˆå¯¹Mach-Oçš„æ¯ä¸€ä¸ªpageï¼Œè¿™å°±ä¿è¯äº†dyldåœ¨åŠ è½½Mach-Oçš„æ—¶å€™å¯ä»¥ç¡®ä¿å•ä¸ªpageä¸è¢«ç¯¡æ”¹ã€‚ é‚£PAGEZEROçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå½“ç³»ç»Ÿåˆ©ç”¨ASLRåˆ†é…äº†éšæœºåœ°å€åï¼Œä»0åˆ°è¯¥åœ°å€çš„æ•´ä¸ªåŒºé—´ä¼šè¢«æ ‡è®°ä¸ºä¸å¯è®¿é—®ï¼Œæ„å‘³ç€ä¸å¯è¯»ï¼Œä¸å¯å†™ï¼Œä¸å¯è¢«æ‰§è¡Œã€‚è¿™ä¸ªåŒºåŸŸçš„å¤§å°è‹¹æœç»™å‡ºäº†å®˜æ–¹çš„è§£é‡Šï¼š é’ˆå¯¹32ä½è¿›ç¨‹ï¼Œè‡³å°‘4KB é’ˆå¯¹64ä½è¿›ç¨‹ï¼Œè‡³å°‘4GB è¿™å—åŒºåŸŸå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ•è·ä»»æ„çš„ç©ºæŒ‡é’ˆå’ŒæŒ‡é’ˆæˆªæ–­ã€‚(ä¾‹å¦‚:64ä½æŒ‡é’ˆè½¬32ä½çš„æ—¶å€™) è™šæ‹Ÿå†…å­˜ç†è§£äº†è™šæ‹Ÿå†…å­˜èƒ½å¤Ÿæ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬ç†è§£iOSå†…éƒ¨æœºåˆ¶ã€‚é¦–å…ˆï¼Œç°æœ‰çš„æ“ä½œç³»ç»Ÿå¤§éƒ½ä½¿ç”¨é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚é€»è¾‘åœ°å€å¯ä»¥ç†è§£ä¸ºæ˜¯è™šæ‹Ÿåœ°å€ï¼Œä¸ºçš„æ˜¯â€æ¬ºéª—Appâ€ï¼›ä½†ç»è¿‡ç¡¬ä»¶å’Œè½¯ä»¶çš„é…åˆï¼Œé€»è¾‘åœ°å€å¯ä»¥è¢«æ˜ å°„åˆ°å®å®åœ¨åœ¨çš„ç‰©ç†åœ°å€ä¸Šã€‚ é€»è¾‘å†…å­˜æ˜¯è¢«åˆ†é¡µçš„ï¼Œå°±åƒä¸€æ•´å—è›‹ç³•è¢«åˆ†æˆå¤šä¸ªå°å—ä¸€æ ·ã€‚ç„¶åé€šè¿‡é¡µè¡¨ï¼Œæ˜ å°„åˆ°ç‰©ç†å†…å­˜ã€‚ç‰©ç†å†…å­˜æ˜¯è¢«åˆ†ä¸ºå¾ˆå¤šå¸§çš„ï¼Œå’Œé€»è¾‘å†…å­˜çš„é¡µç›¸å¯¹åº”ã€‚(é¡µé¢å’Œå¸§çš„å¯¹åº”å…³ç³»ä¸»è¦æ˜¯é€šè¿‡é¡µè¡¨æ¥ä¿å­˜) æ€»çš„æ¥è¯´ï¼Œé€»è¾‘åœ°å€ç©ºé—´(è™šæ‹Ÿå†…å­˜)å¤§å¤§æé«˜äº†CPUçš„ä½¿ç”¨æ•ˆç‡ï¼Œä½¿å¾—å¤šä¸ªç¨‹åºå¯ä»¥è¢«åŒæ—¶ã€æŒ‰éœ€åŠ è½½è¿›å†…å­˜ã€‚ iOSä¸­ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ˜¯ä¸€ä¸ªé€»è¾‘åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”åŒæ—¶æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸Šã€‚è¿™ç§æ˜ å°„ä¸åªæ˜¯â€ä¸€å¯¹ä¸€â€å…³ç³»ï¼Œè¿˜å¯ä»¥æ˜¯â€œä¸€å¯¹0ï¼Œå¤šå¯¹ä¸€â€ã€‚ å½“é€»è¾‘å†…å­˜åœ°å€åœ¨ç‰©ç†å†…å­˜ä¸Šæ²¡æœ‰å¯¹åº”çš„åœ°å€æ—¶ï¼Œå°±ä¼šå‘ç”Ÿpage faulté”™è¯¯ã€‚è¿™æ—¶å€™å†…æ ¸å°±ä¼šåœæ­¢å½“å‰çº¿ç¨‹ï¼Œåˆ†é…ä¸€å—ç‰©ç†å†…å­˜ç»™å½“å‰çš„é€»è¾‘åœ°å€ï¼›å¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªè¿›ç¨‹è¿è¡Œåœ¨ä¸åŒçš„é€»è¾‘åœ°å€ç©ºé—´ï¼Œå®ƒä»¬æ˜¯å¯ä»¥åŒæ—¶æ˜ å°„åˆ°åŒä¸€ç‰©ç†å†…å­˜çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦å®ƒä»¬shareéƒ¨åˆ†çš„RAMäº†ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶ä¸¤ä¸ªè¿›ç¨‹çš„æŸäº›é€»è¾‘åœ°å€ç©ºé—´å¯ä»¥åŒæ—¶æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†åœ°å€ï¼Œé‚£ä¹ˆå¦‚æœå®ƒä»¬ä¸€æ–¹éœ€è¦ä¿®æ”¹è¯¥åœ°å€å†…å®¹çš„è¯ï¼Œè¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿè¿™å°±éœ€è¦ä»‹ç»ä¸‹iOSçš„Copy-On-Write(COW)æœºåˆ¶äº†ã€‚ å½“ä¸€ä¸ªè¿›ç¨‹è¯•å›¾å‘DATA pageå†™å…¥æ•°æ®æ—¶ï¼Œå†…æ ¸ä¼šç«‹åˆ»åˆ›å»ºä¸€ä¸ªæ‹·è´ï¼Œå¹¶æ˜ å°„åˆ°å¦ä¸€ä¸ªç‰©ç†RAM è‡³äºä»€ä¹ˆæ˜¯DATA pageï¼Œ æˆ‘ä»¬ç¨ååœ¨Mach-Oç« èŠ‚ä»‹ç»ã€‚ å½“Copy-On-Writeå‘ç”Ÿçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿdirty page, ä¸ä¹‹ç›¸å¯¹çš„åˆ™æ˜¯clean pageã€‚Clean pageæ˜¯é‚£ç§å†…æ ¸å¯ä»¥ä¹‹åä»ç£ç›˜æ¢å¤çš„æ‹·è´ï¼›è€Œdirty pageåˆ™åŒ…å«äº†è¿›ç¨‹ä¿¡æ¯ï¼Œæ— æ³•è¢«å…¶ä»–è¿›ç¨‹é‡ç”¨ã€‚ å›¾ä¸­RAM 3æ‰€åœ¨çš„pageå°±æ˜¯ä¸€ä¸ªdirty pageã€‚ åœ¨dyldç« èŠ‚æˆ‘ä¼šå†æ¬¡æåˆ°clean pageå’Œdirty pageï¼Œç€é‡è®²è§£dyldæ˜¯å¦‚ä½•é€šè¿‡ä¿®æ”¹Mach-Oçš„__Dataæ®µï¼Œä»è€Œäº§ç”Ÿdirty pageã€‚ Mach-OMach-Oï¼Œå…¨ç§°æ˜¯Mac object file format, æ˜¯ä¸€ç§æ–‡ä»¶ç±»å‹ã€‚å“ªäº›æ–‡ä»¶æ˜¯Mach-Oå‘¢ï¼Ÿ Exectuable: ä¾‹å¦‚æˆ‘ä»¬App bundleä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ Dylib: åŠ¨æ€åº“ï¼Œå¥½æ¯”Windowsä¸‹å¾—DLL Bundle: æŒ‡çš„æ˜¯æ— æ³•è¢«é“¾æ¥ï¼Œåªèƒ½ä½¿ç”¨dlopenåŠ è½½çš„åŠ¨æ€åº“ï¼Œä¾‹å¦‚Macå¹³å°ä¸‹çš„plug-ins Image: ä»¥ä¸Šä¸‰ä¸ª Framework: åŒ…å«èµ„æºæ–‡ä»¶ã€å¤´æ–‡ä»¶ç­‰çš„dylib æ®µ(Segments)Appleçš„Mach-Oæ–‡ä»¶å¯ä»¥åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼š Header: å¤´éƒ¨ï¼Œ åŒ…å«å¯æ‰§è¡Œçš„cpuæ¶æ„ï¼Œæ–‡ä»¶ç±»å‹ç­‰ï¼Œä¾‹å¦‚arm64ï¼Œx86ï¼›MH_EXECUTEã€‚(å¦‚æœåˆå¹¶è¿‡æ¶æ„ï¼Œåˆ™ä¼šæ˜¯Fat Header) Load commands: åŠ è½½å‘½ä»¤ï¼ŒåŒ…å«æ–‡ä»¶çš„ç»„ç»‡æ¶æ„å’Œåœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„å¸ƒå±€æ–¹å¼ Data: æ•°æ®ï¼ŒåŒ…å«load commandsä¸­éœ€è¦çš„å„ä¸ªæ®µ(segment)çš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªSegmentçš„å¤§å°éƒ½æ˜¯Pageçš„æ•´æ•°å€ã€‚ Dataéƒ¨åˆ†ç¤ºæ„å›¾: ä¸Šä¾‹ä¸­ï¼ŒTEXTæ®µå¤§å°æ˜¯3é¡µï¼ŒDATAå’ŒLINKEDITå„æ˜¯ä¸€é¡µã€‚Pageçš„å¤§å°å–å†³äºç¡¬ä»¶çš„æ¶æ„ï¼Œä¾‹å¦‚åœ¨arm64æ¶æ„ä¸‹ï¼Œæ¯é¡µæ˜¯16KBï¼›å…¶ä½™æ¶æ„ä¸‹æ¯é¡µæ˜¯4KBã€‚ Dataéƒ¨åˆ†åŒ…å«å“ªäº›segmentå‘¢ï¼Ÿç»å¤§å¤šæ•°mach-oåŒ…æ‹¬ä»¥ä¸‹ä¸‰æ®µ:__TEXT: ä»£ç æ®µï¼Œåªè¯»ï¼ŒåŒ…æ‹¬å‡½æ•°ï¼Œå’Œåªè¯»çš„å¸¸é‡ï¼Œä¾‹å¦‚Cå­—ç¬¦ä¸²ï¼Œä¸Šå›¾ä¸­ç±»ä¼¼__TEXT, __textçš„éƒ½æ˜¯ä»£ç æ®µ__DATA: æ•°æ®æ®µï¼Œè¯»å†™ï¼ŒåŒ…æ‹¬å¯è¯»å†™çš„å…¨å±€å˜é‡, é™æ€å˜é‡ç­‰ï¼Œä¸Šå›¾ç±»ä¼¼ä¸­çš„__DATA, __dataéƒ½æ˜¯æ•°æ®æ®µ__LINKEDIT: å¦‚ä½•åŠ è½½ç¨‹åº, åŒ…å«äº†æ–¹æ³•å’Œå˜é‡çš„å…ƒæ•°æ®ï¼ˆä½ç½®ï¼Œåç§»é‡ï¼‰ï¼Œä»¥åŠä»£ç ç­¾åç­‰ä¿¡æ¯ã€‚ ä¸‹å›¾æ˜¯æˆ‘ä¸ªäººé¡¹ç›®NetworkTransportçš„Mach-Oæ–‡ä»¶å¸ƒå±€: ä»å›¾ä¸­å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°__TEXTå’Œ__DATA. é‚£__LINKEDITå»å“ªé‡Œäº†å‘¢ï¼Ÿæ®æˆ‘è§‚å¯Ÿ__LINKEDITä¼¼ä¹è¢«éšè—äº†ï¼Œä½†æ˜¯å…¶å­˜å‚¨çš„å…ƒæ•°æ®å´æ˜¯å¯è§çš„ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­ç¬”è€…é€‰ä¸­çš„Dynamic Loader Infoä¸€æ ï¼ŒRebaseçš„ä¿¡æ¯ä¸€è§ˆæ— ä½™çš„å±•ç°åœ¨æˆ‘ä»¬é¢å‰ã€‚ å¹¶ä¸”ï¼Œå½“ä½ å±•å¼€Load Commandsé€‰é¡¹çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°__LINKEDITçš„æ®µå¸ƒå±€ä¿¡æ¯ã€‚ éƒ¨åˆ†(Sections)Sectionæ˜¯æ®µ(Segment)ä¸­çš„å­åŒºåŸŸ, æ¯ä¸ªsectionåŒ…å«çš„å†…å®¹ä¸åŒï¼Œå¤§å°ä¹Ÿæ²¡æœ‰é™åˆ¶ã€‚ä¾‹å¦‚åœ¨__TEXT segmenté‡Œï¼Œ text sectionåŒ…å«çš„æ˜¯å¯æ‰§è¡Œçš„æœºå™¨ç ; cstring sectionåŒ…å«Cç±»å¸¸é‡å­—ç¬¦ä¸²ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œé¢çš„å¸¸é‡æ˜¯æ²¡æœ‰é‡å¤çš„ï¼ŒåŸå› æ˜¯é™æ€è¿æ¥å™¨åœ¨åšæ„å»ºçš„æ—¶å€™ï¼Œåˆå¹¶äº†æœ‰ç›¸åŒå€¼çš„å¸¸é‡ã€‚ PIC(Position Independ Code, code-gen)åœ¨dyldæ‹¼æ¥ä¸åŒçš„dylibsçš„æ—¶å€™ï¼ŒdylibAä¹Ÿéœ€è¦çŸ¥é“å¦‚ä½•è°ƒç”¨dylibBã€‚ä½†æ˜¯ç”±äºæ¯é¡µéƒ½è¢«ç­¾åçš„åŸå› ï¼Œdyldæ˜¯æ— æ³•ç›´æ¥å»ä¿®æ”¹æŒ‡ä»¤çš„ã€‚è¿™æ—¶å€™code-genï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€PICä¼šåœ¨__DATAæ®µä¸ºdylibAåˆ›å»ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘dylibBçš„æŸä¸ªåœ°å€ã€‚æ¯”æ–¹è¯´ï¼šdylibAæƒ³è°ƒç”¨dylibBçš„sayHelloæ–¹æ³•ï¼Œcode-genä¼šå…ˆåœ¨Mach-Oçš„__DATAæ®µä¸­å»ºç«‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘sayHelloï¼Œå†é€šè¿‡è¿™ä¸ªæŒ‡é’ˆå®ç°é—´æ¥è°ƒç”¨ã€‚ dyld (dynamic loader/linker)åŠ è½½dylibsdyldæ˜¯iOSå¹³å°ä¸Šçš„äºŒè¿›åˆ¶åŠ è½½å™¨æˆ–è€…è¯´åŠ¨æ€é“¾æ¥å™¨ï¼Œä¹Ÿæ˜¯å†…æ ¸çš„å¾—åŠ›â€å°åŠ©æ‰‹â€ã€‚å®ƒè´Ÿè´£å°†ç¨‹åºä¾èµ–çš„å„ç§åŠ¨æ€åº“åŠ è½½åˆ°è¿›ç¨‹ã€‚åŒæ—¶ä¹Ÿè‚©è´Ÿç€ä¿®å¤å†…éƒ¨å’Œå¤–éƒ¨æŒ‡é’ˆæŒ‡å‘çš„è´£ä»»(ä¼ é€é—¨ï¼Œdyldå¼€æºä»£ç )ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹dyldæ˜¯å¦‚ä½•å¸®åŠ©å†…æ ¸å®ŒæˆåŠ è½½å·¥ä½œçš„ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒALSRå°†dyldä¹ŸåŠ è½½åˆ°äº†è¿›ç¨‹ä¸­ä¸€ä¸ªéšæœºåœ°å€ï¼Œæ­¤æ—¶çš„dyldå’ŒAppäº«æœ‰åŒæ ·çš„æƒé™ã€‚å…¶å®ä»åŠ è½½å®Œdyldä¹‹åï¼Œå†…æ ¸è¦åšçš„äº‹æƒ…å°±ç»“æŸäº†ï¼Œä¹‹åçš„æ‰€æœ‰æ­¥éª¤éƒ½ç”±dyldå®Œæˆã€‚é¦–å…ˆï¼Œdyldä¼šè¯»å–Mach-Oæ–‡ä»¶ä¸­çš„æŒ‡ä»¤(Load commands)ï¼Œå»å°†å…¶ä¾èµ–çš„å„ä¸ªåŠ¨æ€åº“æ˜ å°„åˆ°å½“å‰çš„é€»è¾‘åœ°å€ç©ºé—´ï¼Œå¦‚æœè¯¥åŠ¨æ€åº“è¿˜ä¾èµ–å…¶ä»–åŠ¨æ€åº“ï¼Œæ¯”æ–¹è¯´ä¸‹å›¾çš„Aåº“ä¾èµ–Cåº“ï¼Œdyldä¼šé€’å½’çš„å°†æ²¡åŠ è½½è¿‡çš„dylibéƒ½åŠ è½½åˆ°å½“å‰è¿›ç¨‹ä¸­(å…·ä½“ç”±ImageLoaderå®Œæˆ)ï¼Œç›´åˆ°æ‰€æœ‰çš„åŠ¨æ€åº“åŠ è½½å®Œæ¯•ã€‚Appleå®˜æ–¹ç§°ï¼Œä¸€ä¸ªAppé€šå¸¸ä¼šåŠ è½½1åˆ°400ä¸ªdylibs! ä¸è¿‡å¹¸è¿çš„æ˜¯ï¼Œè¿™å…¶ä¸­å¤§éƒ¨åˆ†æ˜¯ç³»ç»Ÿçš„dylibsï¼ŒAppleåœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œä¹Ÿå·²ç»å¸®æˆ‘ä»¬æå‰è®¡ç®—å’Œç¼“å­˜äº†è¿™äº›dylibsçš„ä¿¡æ¯ï¼Œè¿™æ ·dyldåŠ è½½å®ƒä»¬çš„æ—¶å€™å°±ä¼šå¿«å¾ˆå¤šã€‚ Dirty &amp; Clean Pageæˆ‘ä»¬åœ¨ä¸Šæ–‡æåˆ°: å½“Copy-On-Writeå‘ç”Ÿæ—¶ï¼Œè¯¥pageä¼šè¢«æ ‡è®°ä¸ºdirtyï¼ŒåŒæ—¶ä¼šè¢«å¤åˆ¶ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥è¿›ä¸€æ­¥ç†è§£è™šæ‹Ÿå†…å­˜å’ŒMach-Oå¸ƒå±€ï¼Œä»¥åŠdyldæ˜¯å¦‚ä½•äº§ç”Ÿå‡ºdirty pageçš„ã€‚ ä¸Šå›¾å±•ç¤ºçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹å…±äº«åŒä¸€ä¸ªdylibçš„ä½¿ç”¨åœºæ™¯ã€‚æˆ‘ä»¬ä»å·¦åˆ°å³çœ‹ï¼Œå·¦è¾¹çš„è¿›ç¨‹1å…ˆåŠ è½½äº†è¯¥åŠ¨æ€åº“ï¼Œé€šè¿‡è¯»å–Load Commands, dyldçŸ¥é“è¦å…ˆåŠ è½½__TEXTæ®µ(å¯è¯»ï¼Œå¯æ‰§è¡Œ)ï¼Œä¸Šå›¾__TEXTæ®µå¤§å°ä¸º3ä¸ªpageï¼Œä½†æ˜¯dyldåªä¼šå…ˆå°†ç¬¬ä¸€ä¸ªpageæ˜ å°„åˆ°ç‰©ç†RAMã€‚ä¹‹åè¯»å–__DATAæ®µä¿¡æ¯(å¯è¯»å¯å†™)ï¼Œåœ¨Mach-Oç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ__DATAæ®µå­˜å‚¨äº†å…¨å±€å˜é‡ï¼Œè€Œå¤§éƒ¨åˆ†çš„å…¨å±€å˜é‡åˆéƒ½è¢«åˆå§‹åŒ–ä¸º0ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡è¢«åŠ è½½çš„æ—¶å€™ï¼Œè™šæ‹Ÿå†…å­˜æŠ€æœ¯ä¼šå°†è¿™äº›å…¨å±€å˜é‡ç›´æ¥åˆ†é…åˆ°ä¸€äº›pageä¸Š(ä¸Šå›¾æ˜¯3ä¸ªpage)ï¼Œä¸ä»ç£ç›˜ä¸­è¯»å–ã€‚æ¥ç€dyldåŠ è½½__LINKEDITæ®µï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°ç‰©ç†RAM2ã€‚å½“dyldåŠ è½½__LINKEDIT(åªè¯»)æ®µæ—¶ï¼Œä¼šè¢«å‘ŠçŸ¥éœ€è¦åšä¸€äº›â€ä¿®æ­£â€ä»¥ä¾¿dylibå¯ä»¥è¢«é¡ºåˆ©è¿è¡Œï¼Œè¿™æ—¶ï¼Œdyldå°±éœ€è¦å‘__DATAæ®µå†™å…¥ä¸€äº›æ•°æ®äº†ã€‚å½“å†™å…¥å‘ç”Ÿæ—¶ï¼Œè¯¥pageå¯¹åº”çš„ç‰©ç†RAMå°±åŒ…å«äº†å½“å‰è¿›ç¨‹ä¿¡æ¯ï¼Œå˜æˆäº†dirty pageã€‚æœ€ç»ˆï¼Œè¿™ä¸ªdylibå ç”¨äº†8ä¸ªpageï¼ŒåŒ…å«2ä¸ªclean pageï¼Œä¸€ä¸ªdirty page(å…¶ä½™è¿˜æœªè¢«æ˜ å°„)ã€‚ è¿™æ—¶ï¼Œå¦‚æœæœ‰ç¬¬äºŒä¸ªè¿›ç¨‹åŒæ—¶å¼•ç”¨äº†è¿™ä¸ªdylibï¼Œé‚£ä¹ˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç¬¬ä¸€æ­¥åŒæ ·æ˜¯åŠ è½½__TEXTæ®µï¼Œä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡å†…æ ¸ä¼šå‘ç°åœ¨ç‰©ç†å†…å­˜çš„æŸä¸€å¤„ï¼Œå·²ç»åŠ è½½è¿‡å¯¹åº”çš„__TEXTæ®µï¼Œæ‰€ä»¥è¿™æ¬¡åªæ˜¯ç®€å•åœ°æŠŠæ˜ å°„é‡å®šå‘ä¸‹ï¼Œä¸åšä»»ä½•IOæ“ä½œã€‚__LINKEDITä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒåŒºåˆ«å°±æ˜¯è¿™æ¬¡å˜å¿«äº†è®¸å¤šã€‚å½“å†…æ ¸åœ¨å¯»æ‰¾__DATAæ®µçš„æ—¶å€™ï¼Œå®ƒå…ˆä¼šå»æ£€æŸ¥æ˜¯å¦è¿˜å­˜åœ¨å¹²å‡€çš„å‰¯æœ¬ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥æ˜ å°„ï¼›å¦‚æœæ²¡æœ‰åˆ™éœ€è¦é‡æ–°ä»ç£ç›˜ä¸­è¯»å–ï¼Œè¯»å–ådyldåšä¿®æ­£ï¼Œæ‰€ä»¥è¿™ä¸ªpageä¹Ÿä¼šå˜ä¸ºdirty pageã€‚å½“dyldå®Œæˆäº†ä¿®æ­£è¿‡ç¨‹åï¼Œ__LINKEDITä¹Ÿå°±ä¸è¢«å†éœ€è¦ï¼Œå†…æ ¸å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™é‡Šæ”¾å…¶æ˜ å°„çš„ç‰©ç†RAMã€‚ æ€»ç»“ä¸‹: å½“ä¸¤ä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªdylibæ—¶,ä½¿ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯æ˜ å°„ç‰©ç†RAMï¼ŒæŠŠåŸæœ¬16ä¸ªè„é¡µé¢å˜æˆäº†ä¸¤ä¸ªè„é¡µé¢å’Œä¸€ä¸ªå¹²å‡€çš„å…±äº«é¡µé¢ã€‚ä½†ä¸Šä¾‹æ˜¯é’ˆå¯¹Appleè‡ªå·±æä¾›çš„åŠ¨æ€åº“ï¼Œå¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„cocoatouch frameworkï¼Œä¸æ’é™¤å½“ä¸¤ä¸ªè¿›ç¨‹å…±ç”¨ä¸€ä¸ªframeworkæ—¶ï¼Œå¯ä»¥å…±äº«æŸäº›pageã€‚ä¾‹å¦‚ä¸¤ä¸ªAppéƒ½ä¾èµ–Alamofireç½‘ç»œåº“æ—¶ï¼Œä¸€ä¸ªAppå…ˆè¡ŒåŠ è½½å…¶Mach-Oæ–‡ä»¶åˆ°ç‰©ç†å†…å­˜ï¼›å½“å¦ä¸€ä¸ªAppåŠ è½½Alamofireæ—¶ï¼Œç›´æ¥æ˜ å°„å³å¯ã€‚ Rebase &amp; Bindingè¿™ä¸ªæ­¥éª¤å°±æ˜¯ä¸Šæ–‡è¯´åˆ°çš„â€ä¿®æ­£â€æ­¥éª¤, åŒæ—¶ä¹Ÿç”¨åˆ°äº†ä¸Šæ–‡æåˆ°çš„PICæŠ€æœ¯ã€‚Reabseæ˜¯æŒ‡ä¿®æ­£å†…éƒ¨æŒ‡é’ˆæŒ‡å‘; Bindingæ˜¯æŒ‡ä¿®æ­£å¤–éƒ¨æŒ‡é’ˆæŒ‡å‘ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º: æŒ‡å‘_mallocå’Œ_freeçš„æŒ‡é’ˆæ˜¯ä¿®æ­£åçš„å¤–éƒ¨æŒ‡é’ˆæŒ‡å‘ã€‚è€ŒæŒ‡å‘__TEXTçš„æŒ‡é’ˆåˆ™æ˜¯è¢«ä¿®å¤åçš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘ã€‚ è¿™ä¸ªæ­¥éª¤å‘ç”Ÿçš„åŸå› æˆ‘ä»¬ä¸Šæ–‡æåˆ°è¿‡: ASLRã€‚ç”±äºèµ·å§‹åœ°å€çš„åç§»ï¼Œæ‰€æœ‰_DATAæ®µå†…æŒ‡å‘Mach-Oæ–‡ä»¶å†…éƒ¨çš„æŒ‡é’ˆéƒ½éœ€è¦å¢åŠ è¿™ä¸ªåç§»é‡, å¹¶ä¸”è¿™äº›æŒ‡é’ˆçš„ä¿¡æ¯å¯ä»¥åœ¨__LINKEDITæ®µä¸­æ‰¾åˆ°ã€‚æ—¢ç„¶Rebaseéœ€è¦å†™å…¥æ•°æ®åˆ°__DATAæ®µï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€Copy-On-WriteåŠ¿å¿…ä¼šå‘ç”Ÿï¼Œdirty pageçš„åˆ›å»ºï¼ŒIOçš„å¼€é”€ä¹Ÿæ— æ³•é¿å…ã€‚ Bindingæ˜¯__DATAæ®µå¯¹å¤–éƒ¨ç¬¦å·çš„å¼•ç”¨ã€‚ä¸è¿‡å’ŒRebaseä¸åŒçš„æ˜¯ï¼Œbindingæ˜¯é å­—ç¬¦ä¸²çš„åŒ¹é…æ¥æŸ¥æ‰¾ç¬¦å·è¡¨çš„ï¼Œè™½è¯´æ²¡æœ‰å¤šå°‘IOï¼Œä½†æ˜¯è®¡ç®—å¤šï¼Œæ¯”Rebaseæ…¢ã€‚ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯æŸ¥çœ‹æ‰€æœ‰Resabeå’ŒBindingçš„ä¿®å¤: 1xcrun dyldinfo -rebase -bind -lazy_bind NetworkTransport.app/NetworkTransport Objc Runtimeç®€ä»‹Objective-C runtimeæ˜¯Objcè¿™æ¬¾è¯­è¨€çš„è¿è¡Œæ—¶å‡½æ•°åº“(ä¼ é€é—¨ï¼ŒRuntimeå¼€æºä»£ç )ï¼Œè´Ÿè´£æ”¯æŒæˆ‘ä»¬æ—¥å¸¸ç”¨åˆ°çš„å„ç§åŠ¨æ€ç‰¹æ€§ï¼Œä¾‹å¦‚Target-Actionï¼ŒAssociated Objectsï¼ŒMethod Swizzlingç­‰ã€‚å½“ç„¶ï¼ŒåŠŸèƒ½è§‰ä¸ä»…é™äºæ­¤ï¼Œè¿è¡Œæ—¶åº“æ›´åƒæ˜¯ä¸€ä¸ªæ¡¥é˜¶å±‚ï¼Œå¸®åŠ©Objcå’Œå…¶ä»–è¯­è¨€æ›´å¥½åœ°ååŒå·¥ä½œã€‚ Objcè¿è¡Œæ—¶åº“æœ‰å¾ˆå¤šçš„DATAæ•°æ®ç»“æ„ï¼Œè¿™äº›å¤§éƒ½æ˜¯ç³»ç»Ÿç±»ï¼Œè¿™äº›ç³»ç»Ÿç±»å°±ä¼šæœ‰å¾ˆå¤šçš„æŒ‡é’ˆï¼Œä¾‹å¦‚æŒ‡å‘å…¶æ–¹æ³•å’Œè¶…ç±»ã€‚å‡ ä¹æ‰€æœ‰çš„è¿™äº›æŒ‡é’ˆçš„ä¿®æ­£éƒ½ä¼šåœ¨ä¸Šä¸€æ­¥å®Œæˆã€‚ä¸è¿‡Objc runtimeè¿˜éœ€è¦åšå¦‚ä¸‹ä¸€äº›äº‹æƒ…: ä¸ºæ¯ä¸€ä¸ªç±»ç”Ÿæˆä¸€å¼ å‡½æ•°è¡¨: åœ¨Objcé‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ¥åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼ŒåŸç†å°±æ˜¯è¯¥ç±»æ‹¥æœ‰å‡½æ•°è¡¨ã€‚ å°†åˆ†ç±»(Category)é‡Œå®šä¹‰çš„æ‰©å±•æ·»åŠ åˆ°å‡½æ•°è¡¨é‡Œ: å¦‚æœåˆ†ç±»overrideçš„åŸç±»çš„æ–¹æ³•ï¼Œåˆ™è¿è¡Œæ—¶ä¼šå°†å…¶æ·»åŠ åˆ°å‡½æ•°è¡¨ä¸Šæ–¹ï¼Œè°ƒç”¨æ—¶å…ˆç”¨Categoryä¸­å®šä¹‰çš„æ–¹æ³•ã€‚ ç¡®ä¿é€‰æ‹©å™¨çš„å”¯ä¸€æ€§: å’Œä¸Šä¸€ä¸ªç±»ä¼¼ï¼ŒObjcæ˜¯ä¾é Selectorçš„ï¼Œæ‰€ä»¥ç¡®ä¿å…¶å”¯ä¸€æ€§å°±ä¿è¯äº†è°ƒç”¨çš„æ­£ç¡®æ€§ã€‚ Load vs Initializeåœ¨Objcæ—¶ä»£ï¼ŒNSObjectä¸­æœ‰ä¸¤ä¸ªå¾ˆç‰¹æ®Šçš„æ–¹æ³•: +load å’Œ +initializeï¼Œå®ƒä»¬è¢«ç”¨äºç±»çš„åˆå§‹åŒ–ã€‚ +loadå½“ç±»æˆ–è€…æ˜¯Categoryè¢«æ·»åŠ åˆ°Objc Runtimeæ—¶ï¼Œ+loadæ–¹æ³•å³è¢«è°ƒç”¨ã€‚ä¸€ä¸ªå¾ˆå…¸å‹çš„ä¾‹å­å°±æ˜¯Method Swizzlingï¼Œç”±äºAppleâ€è‡ªåº•å‘ä¸Šâ€çš„åˆå§‹åŒ–ç­–ç•¥ï¼Œå½“æˆ‘ä»¬æƒ³æ›¿æ¢ç³»ç»Ÿçš„æŸä¸ªå®ç°æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šåœ¨è‡ªå®šä¹‰çš„ç±»ä¸­é‡å†™+loadæ–¹æ³•ï¼Œå®ç°ç›¸å…³ä»£ç ï¼Œå·²è¾¾åˆ°æ›¿æ¢çš„ç›®çš„ã€‚ çˆ¶ç±»+loadæ–¹æ³• å…ˆäº å­ç±»+loadæ–¹æ³•æ‰§è¡Œ;ä¸»ç±»+loadæ–¹æ³• å…ˆäº Categoryçš„+loadæ–¹æ³•æ‰§è¡Œ;ä¸åŒç±»+loadæ–¹æ³•è°ƒç”¨é¡ºåºä¸ç¡®å®šã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹éƒ¨åˆ†å’Œ+loadæ–¹æ³•ç›¸å…³çš„Objc runtimeçš„æºç ï¼Œä»¥åŠ æ·±å¯¹+loadçš„ç†è§£ã€‚é¦–å…ˆæ˜¯æ–‡ä»¶objc-runtime-new.mm ä¸­çš„ prepare_load_methods(header_info *hi) å‡½æ•°ï¼š 123456789101112131415161718192021void prepare_load_methods(const headerType *mhdr)&#123; size_t count, i; runtimeLock.assertLocked(); classref_t *classlist = _getObjc2NonlazyClassList(mhdr, &amp;count); for (i = 0; i &lt; count; i++) &#123; schedule_class_load(remapClass(classlist[i])); &#125; category_t **categorylist = _getObjc2NonlazyCategoryList(mhdr, &amp;count); for (i = 0; i &lt; count; i++) &#123; category_t *cat = categorylist[i]; Class cls = remapClass(cat-&gt;cls); if (!cls) continue; // category for ignored weak-linked class realizeClass(cls); assert(cls-&gt;ISA()-&gt;isRealized()); add_category_to_loadable_list(cat); &#125;&#125; è¿™ä¸ªå‡½æ•°æ˜¯å°†é‚£äº›å®ç°äº†+loadæ–¹æ³•çš„ç±»å’ŒCategoryæ‰¾å‡ºå¹¶å®ç°(realized), ä¹‹åå°†å…¶åŠ å…¥å¯¹åº”çš„loadableåˆ—è¡¨ã€‚å…¶ä¸­ _getObjc2NonlazyClassListå’Œ _getObjc2NonlazyCategoryListä¸¤ä¸ªæ–¹æ³•å°±æ˜¯æ‰¾å‡ºè¿™æ ·çš„ç±»å’ŒCategoryã€‚Non lazyæ„å‘³ç€å®ƒä»¬å®ç°äº†+loadæ–¹æ³•ï¼Œä¸ä¹‹å¯¹åº”çš„åˆ™æ˜¯lazy classï¼Œå®ƒä»¬æ²¡æœ‰å®ç°+loadæ–¹æ³•ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨Appå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–ï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°ç¬¬ä¸€æ¬¡æ¶ˆæ¯æ—¶åˆå§‹åŒ–ï¼Œå¯è°“åå‰¯å…¶å®çš„æ‡’åŠ è½½ã€‚Mach-Oçš„non lazyç±»å¯ä»¥åœ¨__DATA, __objc_nlclslistéƒ¨åˆ†çœ‹åˆ°ã€‚ 12345678910111213static void schedule_class_load(Class cls)&#123; if (!cls) return; assert(cls-&gt;isRealized()); // _read_images should realize if (cls-&gt;data()-&gt;flags &amp; RW_LOADED) return; // Ensure superclass-first ordering schedule_class_load(cls-&gt;superclass); add_class_to_loadable_list(cls); cls-&gt;setInfo(RW_LOADED); &#125; prepare_load_methodsä¸­è¿˜è°ƒç”¨åˆ°äº†schedule_class_loadæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œç¬¬9è¡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°: å‡½æ•°å¯¹ä¼ å…¥å‚æ•°çš„çˆ¶ç±»è¿›è¡Œäº†é€’å½’è°ƒç”¨ï¼Œä»¥ç¡®ä¿çˆ¶ç±»ä¼˜å…ˆçš„é¡ºåºã€‚ å½“ç±»å’ŒCategoryå‡†å¤‡å¥½åï¼ŒObjc runtimeå°±å¯ä»¥å¯¹å®ƒä»¬çš„+loadæ–¹æ³•è°ƒç”¨äº†ã€‚æ‰“å¼€æ–‡ä»¶objc-loadmethod.mï¼Œæ‰¾åˆ°å…¶ä¸­çš„call_load_methodså‡½æ•°ã€‚ 1234567891011121314151617181920212223242526272829void call_load_methods(void)&#123; static bool loading = NO; bool more_categories; loadMethodLock.assertLocked(); // Re-entrant calls do nothing; the outermost call will finish the job. if (loading) return; loading = YES; void *pool = objc_autoreleasePoolPush(); do &#123; // 1. Repeatedly call class +loads until there aren&apos;t any more while (loadable_classes_used &gt; 0) &#123; call_class_loads(); &#125; // 2. Call category +loads ONCE more_categories = call_category_loads(); // 3. Run more +loads if there are classes OR more untried categories &#125; while (loadable_classes_used &gt; 0 || more_categories); objc_autoreleasePoolPop(pool); loading = NO;&#125; è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ç‚¹å€¼å¾—æ³¨æ„: ç¬¬12è¡Œå’Œç¬¬26è¡Œçš„auto release poolæ“ä½œï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨è‡ªå®šä¹‰+loadæ–¹æ³•æ˜¯ä¸éœ€è¦è‡ªå·±æ·»åŠ autoreleaseçš„blockï¼ŒObjc runtimeå¸®æˆ‘ä»¬å¤„ç†äº†ã€‚ ç¬¬17è¡Œå’Œç¬¬21è¡Œï¼Œç±»çš„+loadå…ˆäºCategoryè°ƒç”¨ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹call_class_loadsçš„å®ç°ï¼Œcall_category_loadsæ–¹æ³•å’Œå®ƒå¼‚æ›²åŒå·¥ï¼Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 1234567891011121314151617181920212223242526static void call_class_loads(void)&#123; int i; // Detach current loadable list. struct loadable_class *classes = loadable_classes; int used = loadable_classes_used; loadable_classes = nil; loadable_classes_allocated = 0; loadable_classes_used = 0; // Call all +loads for the detached list. for (i = 0; i &lt; used; i++) &#123; Class cls = classes[i].cls; load_method_t load_method = (load_method_t)classes[i].method; if (!cls) continue; if (PrintLoading) &#123; _objc_inform(&quot;LOAD: +[%s load]\n&quot;, cls-&gt;nameForLogging()); &#125; (*load_method)(cls, SEL_load); &#125; // Destroy the detached list. if (classes) free(classes);&#125; æœ€å…³é”®çš„åœ¨ç¬¬21è¡Œ: (*load_method)(cls, SEL_load)ã€‚è¿™æ„å‘³ç€+loadæ–¹æ³•çš„è°ƒç”¨ä¸æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ objc_msgSend(æ¶ˆæ¯æœºåˆ¶)ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å…¶å†…å­˜åœ°å€çš„æ–¹å¼è°ƒç”¨ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œçˆ¶ç±»ã€å­ç±»å’Œåˆ†ç±»ä¸­çš„+loadæ–¹æ³•çš„å®ç°æ˜¯è¢«åŒºåˆ«å¯¹å¾…çš„ã€‚å¦‚æœå­ç±»å®ç°+loadæ–¹æ³•è€Œçˆ¶ç±»æ²¡æœ‰å®ç°ï¼Œåˆ™çˆ¶ç±»ä¸­çš„+loadæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ï¼›å¦‚æœä¸»ç±»å’Œåˆ†ç±»éƒ½å®ç°äº†+loadæ–¹æ³•ï¼Œåˆ™ä¸¤ä¸ªéƒ½ä¼šè¢«è°ƒç”¨ï¼Œä¸è¿‡Categoryçš„+loadæ–¹æ³•ä¼šåè°ƒï¼Œè¿™ä¹Ÿä¸ºæˆ‘ä»¬å®ç°Swizzlingæä¾›äº†å¥‘æœºã€‚ +initialize+loadæ–¹æ³•åœ¨Swiftä¸­å·²ç»è¢«åºŸå¼ƒ, å®˜æ–¹æ¨èä½¿ç”¨+initializeæ¥å®Œæˆä¹‹å‰åœ¨+loadä¸­å®Œæˆçš„äº‹æƒ…ã€‚+initializeæ–¹æ³•ä¼šåœ¨ç±»æˆ–å…¶å­ç±»æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯(æ–¹æ³•è°ƒç”¨)å‰è°ƒç”¨ã€‚å±äºæ‡’åŠ è½½ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºï¼Œé¿å…æµªè´¹ã€‚ Swift3.1åºŸå¼ƒäº†è¯¥æ–¹æ³•, ä¸è¿‡å¯ä»¥ç”¨Objcçš„Categoryåšè¯¥Swiftç±»çš„æ‰©å±•ï¼Œä¾æ—§å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ï¼›çº¯Swiftç¯å¢ƒä¸‹ä¹Ÿæœ‰æ›¿ä»£æ–¹æ³•ï¼Œä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­ä»‹ç»ã€‚ æ‰“å¼€objc-runtime-new.mmæ–‡ä»¶ï¼Œæ‰¾åˆ°lookUpImpOrForwardæ–¹æ³•: 1234567891011121314151617IMP lookUpImpOrForward(Class cls, SEL sel, id inst, bool initialize, bool cache, bool resolver)&#123; ... if (initialize &amp;&amp; !cls-&gt;isInitialized()) &#123; runtimeLock.unlock(); _class_initialize (_class_getNonMetaClass(cls, inst)); runtimeLock.lock(); // If sel == initialize, _class_initialize will send +initialize and // then the messenger will send +initialize again after this // procedure finishes. Of course, if this is not being called // from the messenger then it won&apos;t happen. 2778172 &#125; ... &#125; å½“è°ƒç”¨æŸä¸ªç±»çš„æ–¹æ³•æ—¶ï¼ŒObjc runtimeä¼šä½¿ç”¨è¿™ä¸ªå‡½æ•°å»æŸ¥æ‰¾æˆ–è€…è½¬å‘è¯¥æ¶ˆæ¯ã€‚å¦‚æœè¯¥ç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™è°ƒç”¨ _class_initializeæ–¹æ³•æ¥åˆå§‹åŒ–ã€‚ 123456789101112131415161718192021222324252627282930void _class_initialize(Class cls)&#123; assert(!cls-&gt;isMetaClass()); Class supercls; bool reallyInitialize = NO; // Make sure super is done initializing BEFORE beginning to initialize cls. // See note about deadlock above. supercls = cls-&gt;superclass; if (supercls &amp;&amp; !supercls-&gt;isInitialized()) &#123; _class_initialize(supercls); &#125; ... #if __OBJC2__ @try#endif &#123; callInitialize(cls); if (PrintInitializing) &#123; _objc_inform(&quot;INITIALIZE: thread %p: finished +[%s initialize]&quot;, pthread_self(), cls-&gt;nameForLogging()); &#125; &#125; ...&#125; ç¬¬12è¡Œçš„é€’å½’è°ƒç”¨ä¿è¯äº†çˆ¶ç±»å…ˆäºå­ç±»åˆå§‹åŒ–ï¼›ç¬¬21è¡Œè°ƒç”¨callInitializeï¼Œä»£ç å¦‚ä¸‹: 123456void callInitialize(Class cls)&#123; ((void(*)(Class, SEL))objc_msgSend)(cls, SEL_initialize); asm(&quot;&quot;);&#125; å¯ä»¥çœ‹å‡º+initializeæ–¹æ³•çš„è°ƒç”¨å’Œæ™®é€šå‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œèµ°çš„éƒ½æ˜¯å‘é€æ¶ˆæ¯çš„æµç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºå¦‚ä½•ï¼Œçˆ¶ç±»çš„+initializeéƒ½ä¼šè¢«è°ƒç”¨ï¼Œè€Œä¸”å¦‚æœCategoryå®ç°äº†+initializeæ–¹æ³•ï¼Œåˆ™ä¼šâ€è¦†ç›–â€æ‰ä¸»ç±»çš„+initializeæ–¹æ³•(Categoryçš„å®ç°åœ¨å‡½æ•°è¡¨ä¸­ä¼˜å…ˆäºä¸»ç±»)ã€‚ è€Œä¸”è¿˜å¸¦æ¥ä¸€ä¸ªé—®é¢˜: å¦‚æœå­ç±»æ²¡æœ‰å®ç°+initializeæ–¹æ³•ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„+initializeæ–¹æ³•ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚å¦‚æœæƒ³ç¡®ä¿è‡ªå·±çš„+initializeæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡çš„è¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼: åˆ¤æ–­å½“å‰Classæ˜¯å¦æ˜¯è¯¥ç±» ä½¿ç”¨dispatch once token(å’Œåˆå§‹åŒ–ä¸€ä¸ªSingletonä¸€æ ·) BTW, æ— è®ºæ˜¯+loadè¿˜æ˜¯+initializeï¼Œéƒ½ä¸éœ€è¦åœ¨è‡ªå·±çš„å®ç°é‡Œè°ƒç”¨super loadæˆ–è€…æ˜¯super initializeã€‚ Mainå‡½æ•°çš„è°ƒç”¨dyldè°ƒç”¨UIApplicationMain()ã€‚ æ€»ç»“ä¸‹: å†…æ ¸åŠ è½½Appå’Œdyldåˆ°è¿›ç¨‹ä¸­ï¼ŒdyldåŠ è½½æ‰€æœ‰ä¾èµ–çš„dylibsï¼Œä¿®æ­£æ‰€æœ‰DATA pageï¼Œä¹‹åObjc runtimeåˆå§‹åŒ–æ‰€æœ‰ç±»ï¼Œæœ€åè°ƒç”¨mainå‡½æ•°ã€‚ å¦‚ä½•ä¼˜åŒ–Appå¯åŠ¨æ—¶é—´ç†¬è¿‡äº†ç†è®ºéƒ¨åˆ†ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å°†å…¶åº”ç”¨åˆ°å®é™…å¼€å‘ä¸­ï¼Œæ¥æå‡æˆ‘ä»¬Appçš„å¯åŠ¨é€Ÿåº¦ã€‚ Appleå·²æœ‰çš„ä¼˜åŒ–Appleçš„dyld 3(ç›®å‰ä½¿ç”¨ç‰ˆæœ¬)ä¸ä¹‹å‰çš„dyld 2ç›¸æ¯”æœ‰äº†æ˜¾è‘—çš„ä¼˜åŒ–ã€‚dyld 3ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆ: è¿›ç¨‹æ— å…³çš„Mach-Oè§£æå™¨ è¿›ç¨‹ç›¸å…³çš„å¯åŠ¨å›è°ƒå¼•æ“ å¯åŠ¨å›è°ƒç¼“å­˜æœåŠ¡ å¯åŠ¨å›è°ƒ(Launch Closure)æ˜¯dyld 3å¼•è¿›çš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡å¯åŠ¨ä½ Appæ‰€æœ‰çš„å¿…è¦ä¿¡æ¯ã€‚æ¯”æ–¹è¯´: ä½ çš„Appç”¨åˆ°å“ªäº›åŠ¨æ€åº“ï¼ŒæŒ‡é’ˆåç§»é‡ï¼Œä»£ç ç­¾åä½ç½®ç­‰ç­‰ã€‚ åœ¨dyld 2æ—¶ä»£ï¼Œæ‰€æœ‰æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å¯åŠ¨æ­¥éª¤éƒ½æ˜¯å‘ç”Ÿåœ¨å†…æ ¸åˆ†é…ç»™ä½ çš„è¿›ç¨‹ä¸­çš„(in-process); è€Œåœ¨dyld 3ä¸­ï¼Œå…³äºMach-Oæ–‡ä»¶çš„è§£æå‘ç”Ÿåœ¨Appç¬¬ä¸€æ¬¡å®‰è£…æˆ–è€…æ˜¯ä¹‹åçš„æ›´æ–°è¿‡ç¨‹ä¸­ã€‚è§£æè¿‡åï¼Œå…³äºAppå¯åŠ¨çš„ä¿¡æ¯ä¼šè¢«å­˜åˆ°ç£ç›˜çš„æŸå¤„ï¼Œä¾›Appå¯åŠ¨æ—¶ä½¿ç”¨ã€‚è¿™ä¸¤æ­¥å¤§å¤§æå‡äº†AppåŠ è½½çš„é€Ÿåº¦ï¼Œç³»ç»Ÿåº“æ˜¯æœ‰å…±äº«ç¼“å­˜çš„ï¼Œæ‰€ä»¥åŠ è½½é€Ÿåº¦ä¸ä¼šæ…¢ï¼Œä½†æˆ‘ä»¬è‡ªå·±Appä¸­ä¹Ÿä¼šæœ‰å¾ˆå¤šä¾èµ–åº“ï¼Œæ¯æ¬¡æ ¹æ®@rpathæŸ¥æ‰¾ï¼Œæ˜ å°„ä¹Ÿæ˜¯å¾ˆè€—æ—¶çš„å·¥ä½œï¼Œè€Œä¸”ä»Appä¸‹è½½ä¹‹åï¼Œè¿™äº›ä¾èµ–åº“ä¹Ÿä¸ä¼šå†å˜äº†ï¼ŒæŠŠå®ƒä»¬æ”¾åˆ°out of processä¸­å®ä¸ºæ˜æ™ºä¹‹ä¸¾ã€‚ ä¸Šå›¾ä¸­è™šçº¿ä»¥ä¸Šéƒ¨åˆ†å°±æ˜¯Appç¬¬ä¸€æ¬¡ä¸‹è½½æˆ–æ›´æ–°æ—¶dyldä¼šåšçš„äº‹æƒ…ã€‚è™šçº¿ä»¥ä¸‹å°±æ˜¯å½“AppåŠ è½½åˆ°è¿›ç¨‹ä¸­ådyldä¼šåšçš„äº‹æƒ…, é™¤äº†éœ€è¦ä»ç¼“å­˜ä¸­è¯»å–å’ŒéªŒè¯ä¿¡æ¯ä¹‹å¤–ï¼Œå…¶ä»–æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚ Appleä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿé™¤äº†æˆ‘ä»¬å·²ç»æåˆ°çš„æ€§èƒ½ä¼˜åŒ–ï¼Œè¿˜æœ‰ä¸¤ä¸ªä¸»è¦åŸå› : å®‰å…¨å’Œå¯é æ€§ã€‚å…ˆè¯´å¯é æ€§: å°†è¿™äº›æ­¥éª¤ç§»å‡ºè¿›ç¨‹æ„å‘³ç€dyldçš„å¤§éƒ¨åˆ†å·¥ä½œå°±åƒæ˜¯ä¸€ä¸ªæ™®é€šçš„å®ˆæŠ¤ç¨‹åºï¼ŒAppleçš„å·¥ç¨‹å¸ˆå¯ä»¥ç”¨æ ‡å‡†å·¥å…·å»æµ‹è¯•å®ƒï¼Œæå‡å¯é æ€§ï¼›è‡³äºå®‰å…¨æ€§ï¼ŒAppleè®¤ä¸ºæœ€å®¹æ˜“è¢«æ”»å‡»çš„æ­¥éª¤æ˜¯è§£æMach-Oå¤´éƒ¨å’ŒæŸ¥è¯¢ä¾èµ–åº“ã€‚æ”»å‡»è€…å¯ä»¥æä¹±Appçš„@rpathè·¯å¾„ï¼Œæˆ–è€…æ›¿æ¢ä¸ºå…¶å®ƒlibraryæ¥å®Œæˆ@rpath confusion attacksã€‚ æ‰€ä»¥Appleå°†å…¶æ”¾å…¥å®ˆæŠ¤è¿›ç¨‹ä¸­åŠ è½½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç¬¦å·è¡¨æŸ¥æ‰¾æ˜¯å¦ä¸€é¡¹è€—æ—¶å·¥ä½œï¼Œä¹Ÿå®Œå…¨å¯ä»¥æ”¾åœ¨è¿›ç¨‹å¤–æ‰§è¡Œã€‚å› ä¸ºé™¤éæ›´æ–°è½¯ä»¶å’Œä¿®æ”¹ä¾èµ–åº“ï¼Œå¦åˆ™è¯¥ä¾èµ–åº“çš„ç¬¦å·è¡¨çš„å†…éƒ¨åç§»é‡æ˜¯ä¸ä¼šå˜çš„ã€‚ é¡¹ç›®ä¼˜åŒ–åœ¨ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¦‚ä½•æµ‹é‡å¯åŠ¨æ—¶é—´ï¼Œä¸ºä»€ä¹ˆå¯åŠ¨æ—¶é—´ä¼šæ…¢ä»¥åŠå¤šé•¿æ—¶é—´çš„å¯åŠ¨æ—¶é—´æ˜¯å¯è¢«æ¥å—çš„ã€‚ æ¨èçš„å¯åŠ¨æ—¶é—´Appleæ¨èçš„å¯åŠ¨æ—¶é—´æ˜¯400ms, å½“ç„¶æœ€å¥½æ˜¯åœ¨Appæ”¯æŒçš„æœ€ä½é…è®¾å¤‡ä¸Šè¾¾åˆ°è¿™ä¸ªæ ‡å‡†ã€‚æœ€é•¿ä¸è¦è¶…è¿‡20sï¼Œå¦åˆ™ç³»ç»Ÿä¼šç›´æ¥killæ‰è¿™ä¸ªAppã€‚ å¦‚ä½•æµ‹é‡å¯åŠ¨æ—¶é—´Appleæä¾›ä¸€ä¸ªå†…ç½®çš„ç¯å¢ƒå˜é‡æ¥è®°å½•Appå¯åŠ¨æ—¶é—´(pre-main): DYLD_PRINT_STATISTICSã€‚ å…·ä½“é…ç½®æ–¹æ³•å¦‚ä¸‹: ä¹‹åå¯åŠ¨Appï¼Œåœ¨consoleä¸­å°±å¯çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯: å€¼å¾—ä¸€æçš„æ˜¯: dyldå¾ˆæ™ºèƒ½ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰£é™¤Debuggerçš„æ’å…¥æ—¶é—´ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒDevç‰ˆæœ¬æ—¶é—´ä¸å‘å¸ƒç‰ˆæœ¬ä¸åŒã€‚ ä¼˜åŒ–å¯åŠ¨æ—¶é—´åŸºäºä¸Šæ–‡çš„consoleä¿¡æ¯ï¼Œæˆ‘ä»¬çš„ä¼˜åŒ–å¯ä»¥ä»4ä¸ªæ–¹é¢æ¥å¼€å§‹: ç¬¬ä¸€: å‡å°‘åŠ¨æ€åº“çš„ä¾èµ–ã€‚åœ¨iOSå¹³å°ä¸‹ï¼Œå°½é‡å‡å°‘é¡¹ç›®æ‰€ä¾èµ–çš„åŠ¨æ€åº“; å¦‚æœæ— æ³•å‡å°‘ï¼Œå°è¯•å°†ä¸åŒåŠ¨æ€åº“åˆå¹¶ã€‚åœ¨é¡¹ç›®å¼€å‘é˜¶æ®µï¼Œæœ‰äº›ç¨‹åºå‘˜åçˆ±åˆ›å»ºCocoaTouch Frameworkï¼Œè§‰å¾—åˆ†ç¦»å‡ºä¸šåŠ¡é€»è¾‘ä»¥åŠä¾èµ–èµ„æºå¯¹å¼€å‘å’Œä»¥åç»´æŠ¤éƒ½æœ‰å¥½å¤„ã€‚ä½†æ˜¯ï¼Œå½“è¿™æ ·åšçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦è€ƒè™‘ä¸‹Appçš„å¯åŠ¨æ—¶é—´ä»¥åŠæ€§èƒ½ï¼Œæ˜¯å¦å€¼å¾—è¿™æ ·åšã€‚Appleçš„WWDC2016(Session 406)ç»™å‡ºäº†ä¸€ä¸ªä¾‹å­: ä¸€ä¸ªé¡¹ç›®ä¾èµ–26ä¸ªåŠ¨æ€åº“ï¼ŒdylibsåŠ è½½æ—¶é—´æ˜¯240æ¯«ç§’; å½“å°†å…¶åˆå¹¶æˆ2ä¸ªåŠ¨æ€åº“æ—¶ï¼ŒåŠ è½½æ—¶é—´å˜ä¸º20æ¯«ç§’ï¼Œå¯ä»¥è¯´æ€§èƒ½æ˜¾è‘—æé«˜ã€‚ ç¬¬äºŒ: å‡å°‘æŒ‡é’ˆçš„ä½¿ç”¨ã€‚ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°, rebaseå’Œbindingçš„æ—¶é—´å æ®äº†æœ€å¤šçš„æ—¶é—´æ¶ˆè€—ã€‚ä¹Ÿå°±æ˜¯è¯´dyldä¿®å¤æŒ‡é’ˆæŒ‡å‘èŠ±è´¹äº†300å¤šæ¯«ç§’ã€‚ä»ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“ï¼Œdyldä¿®å¤çš„æŒ‡é’ˆéƒ½ä½äº__DATAæ®µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å¾ˆç®€å•ï¼Œå‡å°‘é¡¹ç›®ä¸­æŒ‡é’ˆçš„ä½¿ç”¨ã€‚å¦‚ä½•å‡å°‘? å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨çº¯Objcå¼€å‘ï¼Œé‚£å°±è¦é€‚å½“å‡å°‘ç±»çš„ä¸ªæ•°ï¼Œæ ¹æ®WWDC2016(Session 406)ï¼ŒAppleå·¥ç¨‹å¸ˆçš„è¯´æ³•ï¼Œé¡¹ç›®ä¸­åŒ…å«100ï¼Œ1000ä¸ªç±»æ²¡ä»€ä¹ˆå¤ªå¤§çš„overheadï¼Œä½†è¦æ˜¯5000åˆ°20000ä»¥ä¸Šï¼Œåˆ™åŠ è½½æ—¶é—´ä¼šå¤š700åˆ°800æ¯«ç§’ã€‚å¦‚æœå·¥ç¨‹ä½¿ç”¨Swiftå±…å¤šï¼Œç”šè‡³æ˜¯çº¯Swiftï¼Œé‚£ä¹ˆAppleå»ºè®®èƒ½ä½¿ç”¨structåˆ™ä½¿ç”¨structï¼Œå› ä¸ºstructæ˜¯å€¼ç±»å‹ï¼Œä¸ä¼šå¼•å…¥æŒ‡é’ˆ(ä½¿ç”¨åç§»é‡)ã€‚ ç¬¬ä¸‰: ä¼˜åŒ–Objcå»ºç«‹æ—¶é—´ã€‚è¿™ä¸€æ­¥åŒ…å«å››ä¸ªæ­¥éª¤: æ³¨å†Œç±» æ›´æ–°ç±»å®ä¾‹å˜é‡åç§»(ä¾‹å¦‚SDKæ›´æ–°) æ³¨å†ŒCategory é€‰æ‹©å™¨çš„å”¯ä¸€æ€§ è¿™ä¸€æ­¥å…¶å®ä¸ç”¨æˆ‘ä»¬æ¥ä¼˜åŒ–ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„å·¥ä½œAppleå·²ç»å¸®æˆ‘ä»¬åšäº†ï¼Œæ¯”æ–¹è¯´ivarçš„åç§»ï¼Œè¿™äº›ä¼šåœ¨rebase &amp; bindingæ­¥éª¤å®Œæˆã€‚ ç¬¬å››: åˆå§‹åŒ–ã€‚åœ¨iOSå¹³å°ä¸‹ï¼Œå¦‚æœé¡¹ç›®ä½¿ç”¨Objcç¼–å†™ï¼Œå°½é‡å°‘ä½¿ç”¨+loadæ–¹æ³•ï¼Œå¦‚æœéè¦ä½¿ç”¨, æ›¿æ¢ä¸º+initializeï¼Œå»¶è¿ŸåŠ è½½ã€‚å¦‚æœé¡¹ç›®å·²ç»ä½¿ç”¨Swiftç¼–å†™ï¼Œé‚£å°±æ²¡ä»€ä¹ˆä¼˜åŒ–çš„äº†ï¼ŒAppleæš—åœ°é‡Œå¸®æˆ‘ä»¬è°ƒç”¨äº†ä»–ä»¬è‡ªå·±çš„initializer(dispatch_once), ç¡®ä¿Swift classä¸ä¼šè¢«åˆå§‹åŒ–å¤šæ¬¡ã€‚ ä¸è¿‡Appleç»™çš„å¯åŠ¨æ—¶é—´çš„ä¿¡æ¯è¿˜æ˜¯å¤ªå°‘ï¼Œé™¤äº†å‰ä¸‰æ­¥ï¼Œæœ€åä¸€æ­¥å…¶å®æ˜¯å¯ä»¥åº¦é‡çš„ã€‚ç°åœ¨çš„iOS Appå¾ˆå¤šéƒ½åœ¨ä½¿ç”¨Cocoapodsæˆ–æ˜¯CarthageåŠ è½½ç¬¬ä¸‰æ–¹ä¾èµ–åº“ã€‚å¦‚æœæˆ‘ä»¬æƒ³è·å¾—æ¯ä¸€ä¸ªè¿™æ ·çš„ä¾èµ–åº“åˆå§‹åŒ–è€—æ—¶æ—¶é—´ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿç®€å•è¯´å°±æ˜¯Swizzling +loadæ–¹æ³•åŠ ä¸ŠInstrument Static Initializerså·¥å…·æ¥è¿½è¸ªæ—¶é—´æ¶ˆè€—ï¼Œå…·ä½“æ­¥éª¤å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« : å¦‚ä½•ç²¾ç¡®åº¦é‡ iOS App çš„å¯åŠ¨æ—¶é—´. è¿™ç¯‡æ–‡ç« å¤§è‡´ä»‹ç»äº†ä¸‹Appå¯åŠ¨çš„æµç¨‹, æ¶µç›–çš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå¤šï¼Œæ— æ³•åœ¨æœ‰é™çš„ç¯‡å¹…é‡Œé¢å†æ‰©å±•æ›´å¤šã€‚ä»Šåçš„æ–‡ç« é‡Œä¼šæœ‰é’ˆå¯¹æŸä¸€ä¸ªçŸ¥è¯†ç‚¹çš„æ·±å…¥æŒ–æ˜ï¼Œæ•¬è¯·æœŸå¾…! å‚è€ƒé“¾æ¥Objective-C +load vs +initializeä» dyld åˆ° runtimeApp Startup Time: Past, Present, and FutureOptimizing App Startup Timeå¦‚ä½•ç²¾ç¡®åº¦é‡ iOS App çš„å¯åŠ¨æ—¶é—´]]></content>
      <categories>
        <category>å¼€å‘åŸºç¡€</category>
        <category>ä¼˜åŒ–</category>
        <category>åº•å±‚åŸç†</category>
      </categories>
      <tags>
        <tag>dyld</tag>
        <tag>Mach-O</tag>
        <tag>Runtime</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼€ç¯‡]]></title>
    <url>%2F2019%2F0419%2Fopening.html</url>
    <content type="text"><![CDATA[å…³äºæˆ‘æˆ‘æ˜¯ä¸€åiOSå¼€å‘è€…ï¼Œå¶å°”åšåšå®‰å“ï¼ŒWebå’Œæ··åˆå¼€å‘ï¼Œç›®å‰æœ‰5å¹´çš„å¼€å‘ç»éªŒã€‚ æœ€æ—©æ¥è§¦iOSå¼€å‘æ˜¯åœ¨å¤§ä¸‰å°¾å·´ä¸Šçš„æ—¶å€™ï¼Œé‚£ä¸ªæš‘å‡å»é­…æ—å®ä¹ ï¼ŒæŒ£äº†ä¸‡æŠŠå—é’±ï¼Œå°±â€è´¥äº†â€ä¸€å°MBP 13ã€‚å½“æ—¶ä¹°å®ƒçš„ä¸»è¦åŸå› è¿˜ä¸æ˜¯æƒ³åšAppleçš„å¼€å‘ï¼Œæ˜¯æºäºæˆ‘ä»¬çš„Team Leadã€‚ä»–ä»å¾®è½¯å›æ¥ååŠ ç›Ÿçš„é­…æ—ï¼Œä¹Ÿåœ¨å¾®è½¯åšè¿‡Scrum Master, å¸¦é¢†å›¢é˜Ÿã€‚ä»–æåˆ°åœ¨ç¾å›½ï¼Œè€ç¾ä»¬éƒ½ç”¨Macå¼€å‘ï¼Œè¯´å®ƒæ˜¯å¼€å‘åˆ©å™¨ï¼ŒåŠ ä¸Šæˆ‘ä»¬å½“æ—¶åšRuby on Railsï¼Œæ¯æ¬¡çœ‹ä»–â€ç§€â€ç»ˆç«¯æ“ä½œå’Œå·¥å…·çš„æ—¶å€™ï¼Œæ€»è§‰å¾—é‚£æ‰æ˜¯ä¸€ä¸ªå¼€å‘åº”è¯¥æœ‰çš„æ ·å­ã€‚å½“ç„¶ä½ ç”¨å…¶ä»–ç³»ç»Ÿä¸€æ ·å¯ä»¥å¼€å‘ï¼Œä¸€æ ·å¯ä»¥ä½¿ç”¨ç»ˆç«¯æ“ä½œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜æƒ³å­¦iOSå¼€å‘ï¼Œæ¯•ç«Ÿé­…æ—å½“æ—¶ä¹Ÿè¢«èª‰ä¸ºâ€ä¸­å›½çš„Appleâ€ï¼Œæˆ‘ä»¬çš„äº§å“ç»ç†ä¹Ÿæ˜¯è‹¹æœç²‰ï¼Œå¤©å¤©åœ¨çˆ±èŒƒå„¿å…³æ³¨ç€å„ç±»ä¿¡æ¯ã€‚å°±è¿™æ ·ï¼Œåœ¨ä»–ä»¬çš„æŒç»­ç†é™¶ä¸‹ï¼Œæˆ‘è¸ä¸Šäº†iOSå¼€å‘çš„é“è·¯ã€‚ æ•´ä¸ªå¤§å››ä¸€å¹´ç®—æ˜¯å­¦ä¹ iOSçš„å…¥é—¨é˜¶æ®µï¼Œå°¤å…¶æ˜¯åˆšå¼€å§‹ï¼Œå®Œå…¨æä¸æ‡‚å†…åœ¨é€»è¾‘ï¼Œåªèƒ½æŠŠåˆ«äººä»£ç æ‹¿ä¸‹æ¥ï¼Œè·‘é€šäº†å°±ç®—è°¢å¤©è°¢åœ°äº†ã€‚å°±è¿™æ ·æ–­æ–­ç»­ç»­çš„å­¦ä¹ ï¼Œç›´åˆ°æœ¬ç§‘æ¯•ä¸šã€‚æ¯•ä¸šååŠ å…¥äº†ä¸€å®¶æ—…æ¸¸å…¬å¸ï¼Œç®—æ˜¯è…¾è®¯ç³»ï¼Œä¸€å¼€å§‹åœ¨é‡Œé¢åšJavaï¼Œè´Ÿè´£ä¼˜åŒ–ç½‘ç«™æœç´¢å¼•æ“ï¼Œæœ‰æ·±åº¦ï¼Œä½†æ˜¯å¾ˆæ¯ç‡¥ã€‚åšäº†ä¸€ä¸ªæœˆåï¼Œæœ¬æ¥æˆ‘ä»¥ä¸ºæˆ‘å°±è¦åœ¨Javaçš„é“è·¯ä¸Šä¸€å»ä¸å¤è¿”æ—¶ï¼Œå…¬å¸æ¥äº†ä¸¤ä¸ªiOSå¼€å‘ï¼Œè´Ÿè´£ç§»åŠ¨ç«¯çš„ç ”å‘å·¥ä½œã€‚é‚£æ—¶çš„æˆ‘å°±åƒå‘ç°æ•‘å‘½ç¨»è‰ä¸€æ ·ï¼Œèµ¶ç´§å’Œé¢†å¯¼å•†é‡èƒ½ä¸èƒ½è°ƒå»ç§»åŠ¨ç»„ã€‚é¢†å¯¼ä¹Ÿå¾ˆå¿«ç­”åº”äº†ã€‚åˆšæ¥çš„ç§»åŠ¨è´Ÿè´£äººå¢æ°‘ä¹Ÿå¾ˆå¼€å¿ƒï¼Œæ¯•ç«Ÿåˆå¤šä¸€ä¸ªâ€å°å¼Ÿâ€ï¼Œè€Œä¸”è¿˜åšè¿‡ä¸€æ®µæ—¶é—´iOSï¼Œä¸Šæ‰‹åº”è¯¥å¾ˆå¿«ã€‚æ²¡æˆæƒ³ä¸Šæ‰‹å¼€å‘æ‰çŸ¥é“æˆ‘å¯¹å¾ˆå¤šçŸ¥è¯†ç‚¹è¿˜æ˜¯ä¸€çŸ¥åŠè§£ï¼Œå†™å‡ºçš„ä»£ç ç”¨ä»–çš„è¯è¯´å°±æ˜¯â€out of controlâ€ã€‚ä½†ä»–ä¾æ—§æ²¡â€æ”¾å¼ƒâ€æˆ‘ï¼Œè®©æˆ‘å’Œå¦ä¸€ä¸ªiOSå¼€å‘(Matt, ä»PHPè½¬è¡Œè¿‡æ¥)ä¸€èµ·æ­£å¼å¼€å§‹äº†iOSçš„å‡çº§æ‰“æ€ªä¹‹è·¯ã€‚ å°±è¿™æ ·è¿‡äº†åŠå¹´ï¼Œæˆ‘ä»ä¸€ä¸ªè¡Œä¸šå°ç™½æ…¢æ…¢è¸è¿›äº†è¿™è¡Œçš„é—¨ï¼Œç†è§£äº†åŸºæœ¬çš„UIå¼€å‘ï¼Œç†Ÿæ‚‰äº†UIKitã€‚æˆ‘ä»¬ä¸‰ä¸ªä¹Ÿæˆäº†å¥½æœ‹å‹ï¼Œè™½è¯´é‚£æ—¶å€™(2014å¹´)æˆ‘ä»¬å…¬å¸å°±å¼€å§‹å®è¡Œ996ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯ä¼šåœ¨æœ‰é™çš„æ—¶é—´å†…ä¸€èµ·å‡ºå»æå›¢å»ºã€‚ç›´åˆ°ç°åœ¨æˆ‘ä»¬ä¾æ—§è”ç³»ï¼ŒèŠèŠæŠ€æœ¯ï¼ŒèŠèŠå›½å†…çš„ç”Ÿæ´»ã€‚ä¹Ÿæ˜¯ä»é‚£æ—¶èµ·ï¼Œæˆ‘å¼€å§‹å†™åšå®¢ï¼Œä¸è¿‡æ²¡åšæŒå¤šä¹…æˆ‘å°±ç¦»èŒäº†ï¼Œæ”¶æ‹¾å¥½è¡Œå›Šå¥”èµ´æ–°è¥¿å…°æ±‚å­¦ã€‚ æ¥äº†æ–°è¥¿å…°ç”¨äº†åŠå¹´æ—¶é—´(æœ‰æ•ˆè¯»ä¹¦æ—¶é—´)æ‹¿ä¸‹ç ”ç©¶ç”Ÿå­¦ä½ï¼Œå¹¶åœ¨è¯»ä¹¦æœŸé—´å’Œå¥¥å¤§æ•™è‚²ç³»åˆä½œï¼Œå¼€å‘äº†ä¸€æ¬¾æ•™å­¦App; è¿˜æ‰¾åˆ°äº†ä¸€ä»½ç§»åŠ¨å¼€å‘å·¥ä½œ(localæœ¬åœ°å…¬å¸)ï¼Œä¹‹åé¡ºåˆ©æ‹¿ä¸‹äº†ç»¿å¡ã€‚ä¹‹åå°±è·³æ§½åˆ°ç°åœ¨çš„å…¬å¸ï¼Œç›®å‰æ˜¯Fiservé«˜çº§ç§»åŠ¨å¼€å‘å…¼Scrum Masterã€‚ é‡å¼€åšå®¢å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™æˆ‘å·²ç»28å²äº†ï¼Œå›½å†…å¾ˆå¤šè¿™ä¸ªå¹´é¾„çš„å¼€å‘å·²ç»å¼€å§‹è½¬ç®¡ç†å²—äº†ã€‚ç›¸æ¯”å›½å†…ï¼Œå›½å¤–å¥½äº›ï¼Œåšå¼€å‘çš„ç”Ÿå‘½å‘¨æœŸé•¿ç‚¹ï¼Œæ–°è¥¿å…°å…¬å¸ä¹Ÿä¸å¤ªåœ¨ä¹ä½ çš„å¹´çºªï¼Œå¹²çš„åŠ¨ä½ å°±å¹²ã€‚ä½†å³å°†30å²ï¼Œæˆ‘æ€»å¾—æƒ³æ¸…æ¥šè‡ªå·±ä»¥åçš„è·¯æ€ä¹ˆèµ°ï¼Œè¦æˆä¸ºä»€ä¹ˆæ ·çš„äººã€‚ç§»åŠ¨å¼€å‘æ˜¯æˆ‘çš„æœ¬èŒå·¥ä½œï¼Œè‡ªç„¶è¦ç²¾ï¼Œä½†æ€æ ·ç®—ç²¾ï¼Ÿå­¦ä¹ æ— æ­¢å¢ƒï¼Œæ—¶é—´æœ‰é™ï¼Œä¸è¦çå­¦ã€‚ ç§»åŠ¨å¼€å‘æœ€ç«çš„æ—¶å€™å·²ç»è¿‡å»ï¼Œç°åœ¨ç½‘ä¸Šä¸å°‘iOSå¼€å‘æŠ±æ€¨ä¸å¥½æ‰¾å·¥ä½œäº†ï¼Œæ‹¿ä¸åˆ°é‚£ä¹ˆé«˜çš„å·¥èµ„äº†ã€‚ä½†ç»†ç»†åˆ†æå°±ä¼šå‘ç°è¿™ç¾¤äººä¸­å¤§éƒ¨åˆ†éƒ½åšç€å’Œåˆšå…¥è¡Œå·®ä¸å¤šçš„äº‹æƒ…ï¼Œä¹ŸåŸºæœ¬éƒ½å±€é™åœ¨UIçš„å¼€å‘ä¸Š; ç½‘ç»œï¼Œæœ¬åœ°å­˜å‚¨ï¼Œçº¿ç¨‹è¿™äº›åŸºæœ¬çš„æ“ä½œä¹Ÿéƒ½å±€é™åœ¨ä¼šç”¨è€Œå·²ã€‚é‚£å¦‚ä½•æ‰èƒ½æ‘†è„±è¿™ç§å›°å¢ƒï¼Œå®ŒæˆiOSçš„è¿›é˜¶å‘¢ï¼Ÿ ç¬”è€…è®¤ä¸ºï¼Œä¸€ä¸ªä¼˜ç§€çš„iOSå¼€å‘ï¼Œå¿…ç„¶ä¸ä»…ä»…å±€é™åœ¨iOSçš„ä¸–ç•Œä¸­ã€‚ä¸å…¶ç›¸å…³çš„ä»»ä½•æŠ€æœ¯ï¼Œéƒ½åº”è¯¥æœ‰æ‰€ç§¯ç´¯å’Œä¸ªäººè§è§£ï¼Œå¹¶ä¸”å–„äºæ€»ç»“ï¼ŒiOSçš„ä¸–ç•Œå¾ˆå®å¤§ï¼Œä¸ºäº†é¿å…æ— æ•ˆçš„ç§¯ç´¯ï¼Œæœ‰ä¸€å¥—è‡ªæˆ‘å­¦ä¹ çš„æ ‡æ†å’Œæ–¹å‘æ˜¯æ ¼å¤–é‡è¦çš„ã€‚ä»¥ä¸‹çŸ¥è¯†ç‚¹å°±æ˜¯æˆ‘æ€»ç»“çš„iOSè¿›é˜¶ä¹‹è·¯çŸ¥è¯†ä½“ç³»ã€‚ å¼€å‘åŸºç¡€/è¿›é˜¶(Cocoatouch Frameworks, Runtime, ç¼–è¯‘, å†…å­˜, çº¿ç¨‹ç­‰) æµ‹è¯•(Unit/UI Test, PEN Testing, Performance Test, TDDç­‰) æ¶æ„(MVC, MVVM, MVPï¼Œå“åº”å¼ç¼–ç¨‹) CI/CD(DevOps, Jenkins, fastlane, ä»¥åŠä¸€äº›è½»é‡çº§å·¥å…·ç­‰) ç½‘ç»œ(æœåŠ¡å™¨çš„å®ç°ï¼Œç¼“å­˜ä¼˜åŒ–ï¼Œè®¤è¯åŠå®‰å…¨ç­‰) å­˜å‚¨(æ²™ç›’æœºåˆ¶ï¼ŒæŒä¹…åŒ–æ–¹æ¡ˆï¼ŒKeychain) å®‰å…¨(æœ¬åœ°æ•°æ®ä¿æŠ¤ï¼Œç½‘ç»œå®‰å…¨ï¼Œåç¼–è¯‘å’Œä»£ç æ··æ·†) å¤šåª’ä½“(éŸ³é¢‘ï¼Œè§†é¢‘ï¼Œå›¾å½¢å›¾åƒ) ç‰ˆæœ¬æ§åˆ¶(Git, Code Reviewç­‰) è¯ä¹¦(åŸç†ï¼Œé‡æ–°ç­¾åç­‰) ä¼˜åŒ–(ç»Ÿè®¡åŸ‹ç‚¹ï¼ŒAppç˜¦èº«ï¼Œç”µé‡ä¼˜åŒ–ç­‰) è·¨å¹³å°æ–¹æ¡ˆ(Flutter, RN, å®ç°åŸç†) æ™ºèƒ½æ—¶ä»£(ARKit, CoreML) è½¯å®åŠ›æå‡(æ•æ·å¼€å‘ï¼Œé¡¹ç›®ç®¡ç†) Androidå¼€å‘ ç½‘ä¸Šæœ‰å¾ˆå¤šiOSçŸ¥è¯†ä½“ç³»çš„è„‘å›¾ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒã€‚é‡è¦çš„æ˜¯æ‰¾åˆ°é€‚åˆè‡ªå·±å­¦ä¹ è·¯çº¿ï¼Œå°†å¹³æ—¥çš„å­¦ä¹ æœ‰çš„æ”¾çŸ¢çš„å½’ç±»ã€‚ åšå®¢çš„å®è§‚è·¯çº¿ç¬”è€…çš„åšå®¢å: å…¨æ ˆiOSã€‚çœ‹ä¸Šå»å¯èƒ½ä¸å¥½ç†è§£ã€‚æˆ‘åœ¨æ­¤ç¨ä½œè§£é‡Šã€‚å°±å¦‚æˆ‘ä¸Šæ–‡æåˆ°çš„: ä¸€ä¸ªä¼˜ç§€çš„iOSå¼€å‘ï¼Œå¿…ç„¶ä¸ä»…ä»…æ˜¯å±€é™åœ¨iOSçš„ä¸–ç•Œä¸­ã€‚æ— è®ºæ˜¯ç½‘ç»œçŸ¥è¯†è¿˜æ˜¯å®‰å…¨çŸ¥è¯†ï¼Œéƒ½åº”è¯¥æœ‰æ¶‰çŒï¼Œå¹¶æœ‰è‡ªå·±çš„ä¸€å¥—è§£å†³é—®é¢˜çš„é€»è¾‘, æŠ€æœ¯é€‰å‹ï¼Œé£é™©è¯„ä¼°ç­‰ç­‰ã€‚æ€»è€Œè¨€ä¹‹å°±æ˜¯: å¯¹äºç§»åŠ¨å¼€å‘ï¼Œä»äº§å“çš„è®¾è®¡åˆ°å‘å¸ƒè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ èƒ½æä¾›æ‰€æœ‰ç¯èŠ‚çš„æŠ€æœ¯æ”¯æŒå’Œå›¢é˜Ÿç®¡ç†èƒ½åŠ›ã€‚è¿™äº›å¦‚æœéƒ½èƒ½å¾ˆå¥½åœ°å®Œæˆï¼Œé‚£ä¹ˆè¿™åiOSå¼€å‘å°±å¯ä»¥ç§°ä¸ºâ€å…¨æ ˆiOSâ€ï¼Œè€Œä¸”æ»¡è¶³æ— è®ºæ˜¯ç»„é•¿è¿˜æ˜¯æŠ€æœ¯ç»„é•¿çš„è€ƒæ ¸è¦æ±‚ã€‚ æœ¬åšå®¢å°±å»ºç«‹åœ¨è¿™ä¸ªç›®æ ‡ä¹‹ä¸Šï¼Œä¹‹åçš„æ–‡ç« ä¹Ÿéƒ½ä¼šå½’å±äºä»¥ä¸Šçš„å¤§ç±»ã€‚åŒæ—¶æˆ‘ä¹Ÿä¼šç»´æŠ¤ä¸€ä¸ªgithubä»“åº“ï¼ŒæŠŠåšå®¢æ¶‰åŠåˆ°çš„ä»£ç èµ„æºå…¬å¼€ï¼Œä»¥æ–¹ä¾¿è¯»è€…ä»¬å­¦ä¹ å’Œäº¤æµã€‚]]></content>
      <categories>
        <category>çŸ¥è¯†ä½“ç³»</category>
        <category>è½¯å®åŠ›</category>
      </categories>
      <tags>
        <tag>è‡ªæˆ‘æ€»ç»“</tag>
      </tags>
  </entry>
</search>
